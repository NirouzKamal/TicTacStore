const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./hPEptUPX.js","./QjRxgrZG.js","./Cz8qb5NI.css","./BXE2Xjof.js","./BFARcyzA.css","./BIU7wqK-.js"])))=>i.map(i=>d[i]);
import{X as xe,M as Le,h as Vt}from"./QjRxgrZG.js";import{w as Wt,E as Ue,M as Pe,R as $e}from"./BXE2Xjof.js";const h={init:function(n){n===void 0&&h.zg!==void 0||(h.zg=!!n),h.i||(h.i=!0)},destroy:function(){h.i=!1,h.zg=void 0,h.vd=void 0},setLogger:function(n){typeof n=="function"?(h.init(),h.vd=n):h.info("Ignoring setLogger call since logger is not a function")},toggleLogging:function(){h.init(),h.zg?(console.log("Disabling Braze logging"),h.zg=!1):(console.log("Enabled Braze logging"),h.zg=!0)},info:function(n){if(h.zg){const t="Braze: "+n;h.vd!=null?h.vd(t):console.log(t)}},warn:function(n){if(h.zg){const t="Braze SDK Warning: "+n+" (v6.2.0)";h.vd!=null?h.vd(t):console.warn(t)}},error:function(n){if(h.zg){const t="Braze SDK Error: "+n+" (v6.2.0)";h.vd!=null?h.vd(t):console.error(t)}}},I={uc:"pc",wu:"i",pu:"ie",Al:"ss",Dl:"se",Gi:"si",$i:"sc",Fi:"sbc",lc:"lr",nc:"uae",mc:"lcaa",dc:"lcar",Gn:"inc",Rn:"add",On:"rem",$n:"set",Bn:"ncam",fc:"sgu",ot:"bc"},At={oe:function(){const n=(t=!1)=>{const e=(Math.random().toString(16)+"000000000").substr(2,8);return t?"-"+e.substr(0,4)+"-"+e.substr(4,4):e};return n()+n(!0)+n(!0)+n()}};class A{constructor(t,e){this.database=t,this.vd=e,this.parent=typeof window>"u"?self:window,this.database=t,this.vd=e}Dd(){if("indexedDB"in this.parent)return this.parent.indexedDB}isSupported(){var t;try{if(this.Dd()==null)return!1;{const e=(t=this.Dd())===null||t===void 0?void 0:t.open("Braze IndexedDB Support Test");if(e&&(e.onupgradeneeded=()=>e.result.close(),e.onsuccess=()=>e.result.close()),typeof window<"u"){const s=window,i=s.chrome||s.browser||s.pd;if(i&&i.runtime&&i.runtime.id)return this.vd.info("Not using IndexedDB for storage because we are running inside an extension"),!1}return!0}}catch(e){return this.vd.info("Not using IndexedDB for storage due to following error: "+e),!1}}Bd(t,e){var s;const i=(s=this.Dd())===null||s===void 0?void 0:s.open(this.database.Sd,this.database.VERSION);if(i==null)return typeof e=="function"&&e(),!1;const r=this;return i.onupgradeneeded=o=>{var l;r.vd.info("Upgrading indexedDB "+r.database.Sd+" to v"+r.database.VERSION+"...");const u=(l=o.target)===null||l===void 0?void 0:l.result;for(const c in r.database.Fs){const f=c;r.database.Fs.hasOwnProperty(c)&&!u.objectStoreNames.contains(r.database.Fs[f])&&u.createObjectStore(r.database.Fs[f])}},i.onsuccess=o=>{var l;const u=(l=o.target)===null||l===void 0?void 0:l.result;u.onversionchange=()=>{u.close(),typeof e=="function"&&e(),r.vd.error("Needed to close the database unexpectedly because of an upgrade in another tab")},t(u)},i.onerror=o=>{var l;const u=o;return r.vd.info("Could not open indexedDB "+r.database.Sd+" v"+r.database.VERSION+": "+((l=u.target)===null||l===void 0?void 0:l.errorCode)),typeof e=="function"&&e(),!0},!0}setItem(t,e,s,i,r){if(!this.isSupported())return typeof r=="function"&&r(),!1;const o=this;return this.Bd(l=>{if(!l.objectStoreNames.contains(t))return o.vd.error("Could not store object "+e+" in "+t+" on indexedDB "+o.database.Sd+" - "+t+" is not a valid objectStore"),typeof r=="function"&&r(),void l.close();const u=l.transaction([t],"readwrite");u.oncomplete=()=>l.close();const c=u.objectStore(t).put(s,e);c.onerror=()=>{o.vd.error("Could not store object "+e+" in "+t+" on indexedDB "+o.database.Sd),typeof r=="function"&&r()},c.onsuccess=()=>{typeof i=="function"&&i()}},r)}getItem(t,e,s){if(!this.isSupported())return!1;const i=this;return this.Bd(r=>{if(!r.objectStoreNames.contains(t))return i.vd.error("Could not retrieve object "+e+" in "+t+" on indexedDB "+i.database.Sd+" - "+t+" is not a valid objectStore"),void r.close();const o=r.transaction([t],"readonly");o.oncomplete=()=>r.close();const l=o.objectStore(t).get(e);l.onerror=()=>{i.vd.error("Could not retrieve object "+e+" in "+t+" on indexedDB "+i.database.Sd)},l.onsuccess=u=>{var c;const f=(c=u.target)===null||c===void 0?void 0:c.result;f!=null&&s(f)}})}jr(t,e,s){if(!this.isSupported())return typeof s=="function"&&s(),!1;const i=this;return this.Bd(r=>{if(!r.objectStoreNames.contains(t))return i.vd.error("Could not retrieve last record from "+t+" on indexedDB "+i.database.Sd+" - "+t+" is not a valid objectStore"),typeof s=="function"&&s(),void r.close();const o=r.transaction([t],"readonly");o.oncomplete=()=>r.close();const l=o.objectStore(t).openCursor(null,"prev");l.onerror=()=>{i.vd.error("Could not open cursor for "+t+" on indexedDB "+i.database.Sd),typeof s=="function"&&s()},l.onsuccess=u=>{var c;const f=(c=u.target)===null||c===void 0?void 0:c.result;f!=null&&f.value!=null&&f.key!=null?e(f.key,f.value):typeof s=="function"&&s()}},s)}be(t,e){if(!this.isSupported())return!1;const s=this;return this.Bd(i=>{if(!i.objectStoreNames.contains(t))return s.vd.error("Could not delete record "+e+" from "+t+" on indexedDB "+s.database.Sd+" - "+t+" is not a valid objectStore"),void i.close();const r=i.transaction([t],"readwrite");r.oncomplete=()=>i.close(),r.objectStore(t).delete(e).onerror=()=>{s.vd.error("Could not delete record "+e+" from "+t+" on indexedDB "+s.database.Sd)}})}Ds(t,e){if(!this.isSupported())return!1;const s=this;return this.Bd(i=>{if(!i.objectStoreNames.contains(t))return s.vd.error("Could not retrieve objects from "+t+" on indexedDB "+s.database.Sd+" - "+t+" is not a valid objectStore"),void i.close();const r=i.transaction([t],"readwrite");r.oncomplete=()=>i.close();const o=r.objectStore(t),l=o.openCursor(),u=[];l.onerror=()=>{u.length>0?(s.vd.info("Cursor closed midway through for "+t+" on indexedDB "+s.database.Sd),e(u)):s.vd.error("Could not open cursor for "+t+" on indexedDB "+s.database.Sd)},l.onsuccess=c=>{var f;const g=(f=c.target)===null||f===void 0?void 0:f.result;g!=null?(g.value!=null&&g.key!=null&&(o.delete(g.key).onsuccess=()=>{u.push(g.value)}),typeof g.continue=="function"&&g.continue()):u.length>0&&e(u)}})}clearData(){if(!this.isSupported())return!1;const t=[];for(const s in this.database.Fs){const i=s;this.database.Fs.hasOwnProperty(s)&&this.database.Fs[i]!==this.database.Fs.le&&t.push(this.database.Fs[i])}const e=this;return this.Bd(function(s){const i=s.transaction(t,"readwrite");i.oncomplete=()=>s.close();for(let r=0;r<t.length;r++){const o=t[r];i.objectStore(o).clear().onerror=function(){e.vd.error("Could not clear "+this.source.name+" on indexedDB "+e.database.Sd)}}i.onerror=function(){e.vd.error("Could not clear object stores on indexedDB "+e.database.Sd)}})}}A.Us={Rs:{Sd:"AppboyServiceWorkerAsyncStorage",VERSION:6,Fs:{Tu:"data",hr:"pushClicks",cu:"pushSubscribed",Cd:"fallbackDevice",As:"cardUpdates",le:"optOut",wr:"pendingData",xh:"sdkAuthenticationSignature"},me:1}};const he={_o:"allowCrawlerActivity",Ro:"baseUrl",Wo:"noCookies",Vo:"devicePropertyAllowlist",Aa:"disablePushTokenMaintenance",Yo:"enableLogging",Xo:"enableSdkAuthentication",qa:"manageServiceWorkerExternally",Zo:"minimumIntervalBetweenTriggerActionsInSeconds",Wh:"sessionTimeoutInSeconds",Vh:"appVersion",Kh:"appVersionNumber",Ma:"serviceWorkerLocation",ka:"safariWebsitePushId",Xn:"localization",er:"contentSecurityNonce",re:"allowUserSuppliedJavascript",Jo:"inAppMessageZIndex",Do:"openInAppMessagesInNewTab",Lh:"requireExplicitInAppMessageDismissal",$h:"doNotLoadFontAwesome",Jh:"deviceId",_a:"serviceWorkerScope",Yh:"sdkFlavor",tn:"openCardsInNewTab"};function zt(n){const t=[];let e;for(const s in n)e=s,Object.prototype.hasOwnProperty.call(n,e)&&n[e]!==void 0&&t.push(n[e]);return t}function ut(n,t,e,s){const i=zt(n);return i.indexOf(t)!==-1||(h.error(`${e} Valid values from ${s} are "${i.join('"/"')}".`),!1)}function F(n){return Array.isArray?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"}function st(n){return Object.prototype.toString.call(n)==="[object Date]"}function jt(n){return Object.prototype.toString.call(n)==="[object Object]"}function lt(n){const t=[];for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.push(e);return t}function St(n,t){if(n===t)return n!==0||1/n==1/t;if(n==null||t==null)return n===t;const e=n.toString();if(e!==t.toString())return!1;switch(e){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:+n==0?1/+n==1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t}const s=e==="[object Array]";if(!s){if(typeof n!="object"||typeof t!="object")return!1;const l=n.constructor,u=t.constructor;if(l!==u&&!(typeof l=="function"&&l instanceof l&&typeof u=="function"&&u instanceof u)&&"constructor"in n&&"constructor"in t)return!1}const i=[],r=[];let o=i.length;for(;o--;)if(i[o]===n)return r[o]===t;if(i.push(n),r.push(t),s){if(o=n.length,o!==t.length)return!1;for(;o--;)if(!St(n[o],t[o]))return!1}else{const l=lt(n);let u;if(o=l.length,lt(t).length!==o)return!1;for(;o--;)if(u=l[o],!Object.prototype.hasOwnProperty.call(t,u)||!St(n[u],t[u]))return!1}return i.pop(),r.pop(),!0}function qt(n,t=!1){let e=n/1e3;return t&&(e=Math.floor(e)),e}function Fe(n){return 1e3*n}function Qt(n){if(n==null)return null;const t=parseInt(n.toString());return isNaN(t)?null:new Date(1e3*t)}function Rt(n){return n!=null&&st(n)?n.toISOString().replace(/\.[0-9]{3}Z$/,""):n}function Xt(n){return n==null||n===""?null:new Date(n)}function ze(n){return n==null||n===""?new Date().valueOf():n}function ce(n){return(new Date().valueOf()-n.valueOf())/1e3}function de(n){return(n.valueOf()-new Date().valueOf())/1e3}const ve="setCustomUserAttribute",te="Braze must be initialized before calling methods.",qe=30,Je=30,Ge=72e5,Ve=15,Kt=1,ye="Banners are disabled. Make sure you have at least one campaign and relaunch the app.";class ${constructor(){this.yi={}}wt(t){if(typeof t!="function")return null;const e=At.oe();return this.yi[e]=t,e}removeSubscription(t){delete this.yi[t]}removeAllSubscriptions(){this.yi={}}sc(){return Object.keys(this.yi).length}L(t){const e=[];for(const s in this.yi){const i=this.yi[s];e.push(i(t))}return e}}function Mt(n){const t=n?.lt(d.ct.uE);let e;return t&&(e={label:t.l,name:t.a}),e}class X{constructor(t,e,s,i,r){this.userId=t,this.type=e,this.time=s,this.sessionId=i,this.data=r,this.userId=t,this.type=e,this.time=ze(s),this.sessionId=i,this.data=r}Ar(){var t;const e={name:this.type,time:qt(this.time),data:this.data||{},session_id:this.sessionId};this.userId!=null&&(e.user_id=this.userId);const s=((t=b.Sr())===null||t===void 0?void 0:t.fh())||!1;if(!e.user_id&&!s){const i=Mt(b.p());i&&(e.alias=i)}return e}dt(){return{u:this.userId,t:this.type,ts:this.time,s:this.sessionId,d:this.data}}static fromJson(t){return new X(t.user_id,t.name,t.time,t.session_id,t.data)}static gE(t){return t!=null&&jt(t)&&t.t!=null&&t.t!==""}static qn(t){return new X(t.u,t.t,t.ts,t.s,t.d)}}const ot=n=>n instanceof Error?n.message:String(n);class it{constructor(t,e,s){this.eu=t,t==null&&(t=At.oe()),!s||isNaN(s)?this.Gl=new Date().valueOf():this.Gl=s,this.eu=t,this.ql=new Date().valueOf(),this.kl=e}dt(){return`g:${encodeURIComponent(this.eu)}|e:${this.kl}|c:${this.Gl}|l:${this.ql}`}static AE(t){if(typeof t!="string")return null;const e=t.lastIndexOf("|e:"),s=t.substring(0,e),i=s.split("g:")[1];let r;return r=/[|:]/.test(i)?encodeURIComponent(i):i,t=t.replace(s,`g:${r}`)}static qn(t){let e;if(typeof t=="string")try{const s=t.split("|");if(!F(s)||s.length!==4)return null;const i=o=>o.split(":")[1],r=o=>{const l=parseInt(i(o));if(!isNaN(l))return l};e=new it(decodeURIComponent(i(s[0])),r(s[1]),r(s[2])),e.ql=r(s[3])}catch(s){h.info(`Unable to parse cookie string ${t}, failed with error: ${ot(s)}`)}else{if(t==null||t.g==null)return null;e=new it(t.g,t.e,t.c),e.ql=t.l}return e}}function Bt(n){let t=n.length;for(let e=n.length-1;e>=0;e--){const s=n.charCodeAt(e);s>127&&s<=2047?t++:s>2047&&s<=65535&&(t+=2),s>=56320&&s<=57343&&e--}return t}function Ke(n){try{n=n.replace(/-/g,"+").replace(/_/g,"/");const t=window.atob(n),e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);const s=new Uint16Array(e.buffer);return String.fromCharCode(...s)}catch(t){return h.error("Unable to decode Base64: "+t),null}}const k={types:{io:"container",logCustomEvent:"logCustomEvent",setEmailNotificationSubscriptionType:"setEmailNotificationSubscriptionType",setPushNotificationSubscriptionType:"setPushNotificationSubscriptionType",setCustomUserAttribute:"setCustomUserAttribute",requestPushPermission:"requestPushPermission",addToSubscriptionGroup:"addToSubscriptionGroup",removeFromSubscriptionGroup:"removeFromSubscriptionGroup",addToCustomAttributeArray:"addToCustomAttributeArray",removeFromCustomAttributeArray:"removeFromCustomAttributeArray",mo:"openLink",uo:"openLinkInWebView"},properties:{type:"type",eo:"steps",so:"args"}},Ee={Li:"unknownBrazeAction"},He=(n,t)=>n===Ee.Li?`${t} contains an unknown braze action type and will not be displayed.`:"";function We(n){try{const t=n.match(Zt),e=t?t[0].length:null,s=e?n.substring(e):null;if(e==null||e>n.length-1||!s)return void h.error(`Did not find base64 encoded brazeAction in url to process : ${n}`);const i=Ke(s);return i?JSON.parse(i):void h.error(`Failed to decode base64 encoded brazeAction: ${s}`)}catch(t){return void h.error(`Failed to process brazeAction URL ${n} : ${ot(t)}`)}}function we(n,t){let e=!1;if(t){for(const s of t)if(e=e||n(s),e)return!0}return!1}function Se(n){const t=k.properties.type,e=k.properties.eo;try{if(n==null)return!0;const s=n[t];return s===k.types.io?we(Se,n[e]):!ns(s)}catch{return!0}}function Te(n){if(!n||!is(n))return!1;const t=k.properties.type,e=k.properties.eo,s=n[t];return s===k.types.io?we(Te,n[e]):s===k.types.requestPushPermission}const Qe=/^[^\x00-\x1F\x22]+$/,Xe=/[$.]/,Me=["$add","$update","$remove","$identifier_key","$identifier_value","$new_object","$time","$google_ad_personalization","$google_ad_user_data"],Ze=new RegExp(/^.+@.+\..+$/),Zt=/^brazeActions:\/\/v\d+\//,Ye=/^[^\s]+$/;function nt(n,t,e){const s=n!=null&&typeof n=="string"&&(n===""||n.match(Qe)!=null);return s||h.error(`Cannot ${t} because ${e} "${n}" is invalid.`),s}function ee(n){return n!=null&&n.match(Xe)&&Me.indexOf(n)===-1&&h.warn("Custom attribute keys cannot contain '$' or '.'"),nt(n,"set custom user attribute","the given key")}function se(n){const t=typeof n;return n==null||t==="number"||t==="boolean"||st(n)||t==="string"}function Yt(n,t,e){const s=e!==-1;if(s&&e>50)return h.error("Nested attributes cannot be more than 50 levels deep."),!1;const i=s?e+1:-1;if(F(n)&&F(t)){for(let r=0;r<n.length&&r<t.length;r++)if(st(n[r])&&(t[r]=Rt(n[r])),!Yt(n[r],t[r],i))return!1}else{if(!jt(n))return se(n);for(const r of lt(n)){const o=n[r];if(s&&!ee(r)||(st(o)&&(t[r]=Rt(o)),!Yt(o,t[r],i)))return!1}}return!0}function ts(n,t,e,s,i){let r;return r=jt(n)||F(n)?Yt(n,t,1):se(n),r||h.error(`Cannot ${e} because ${s} "${n}" is invalid.`),r}function H(n,t,e,s=!1){const i=typeof n=="string"||n===null&&s;return i||h.error(`Cannot ${t} because ${e} "${n}" is invalid.`),i}function Ce(n,t,e,s,i){if(n==null&&(n={}),typeof n!="object"||F(n))return h.error(`${t} requires that ${e} be an object. Ignoring ${i}.`),[!1,null];let r,o;r=76800,o="75KB";const l=JSON.stringify(n);if(Bt(l)>r)return h.error(`Could not ${s} because ${e} was greater than the max size of ${o}.`),[!1,null];let u;try{u=JSON.parse(l)}catch{return h.error(`Could not ${s} because ${e} did not contain valid JSON.`),[!1,null]}for(const c in n){if(!ee(c))return[!1,null];if(!nt(c,s,`the ${i} property name`))return[!1,null];const f=n[c];if(st(f)&&(u[c]=Rt(f)),!ts(f,u[c],s,`the ${i} property "${c}"`))return[!1,null]}return[!0,u]}function es(n,t){let e=!1,s=!1;const i=()=>{h.error("Custom attribute arrays must be either string arrays or object arrays.")};for(const r of t)if(typeof r=="string"){if(s)return i(),[!1,!1];if(!nt(r,`set custom user attribute "${n}"`,"the element in the given array"))return[!1,!1];e=!0}else{if(!jt(r))return i(),[!1,!1];if(e)return i(),[!1,!1];if(!Ce(r,ve,"attribute value",`set custom user attribute "${n}"`,"custom user attribute"))return[!1,!1];s=!0}return[e,s]}function ss(n){return typeof n=="string"&&n.toLowerCase().match(Ze)!=null}function is(n){if(!(k.properties.type in n))return!1;switch(n[k.properties.type]){case k.types.io:if(k.properties.eo in n)return!0;break;case k.types.logCustomEvent:case k.types.setEmailNotificationSubscriptionType:case k.types.setPushNotificationSubscriptionType:case k.types.setCustomUserAttribute:case k.types.addToSubscriptionGroup:case k.types.removeFromSubscriptionGroup:case k.types.addToCustomAttributeArray:case k.types.removeFromCustomAttributeArray:case k.types.mo:case k.types.uo:if(k.properties.so in n)return!0;break;case k.types.requestPushPermission:return!0;default:return!1}return!1}function ns(n){let t=!1;return Object.keys(k.types).forEach(e=>{k.types[e]!==n.toString()||(t=!0)}),t}function rs(n){return Ye.test(n)}class O{constructor(t,e){this.Cs=t,this.Cn=e,this.Cs=t,this.Cn=e}getUserId(t){const e=this.Cs.getUserId();if(typeof t!="function")return e;h.warn("The callback for getUserId is deprecated. You can access its return value directly instead (e.g. `const id = braze.getUser().getUserId()`)"),t(e)}addAlias(t,e){return!H(t,"add alias","the alias",!1)||t.length<=0?(h.error("addAlias requires a non-empty alias"),!1):!H(e,"add alias","the label",!1)||e.length<=0?(h.error("addAlias requires a non-empty label"),!1):this.Cn.En(t,e).W}setFirstName(t){return!!H(t,"set first name","the firstName",!0)&&this.Cs.nu("first_name",t)}setLastName(t){return!!H(t,"set last name","the lastName",!0)&&this.Cs.nu("last_name",t)}setEmail(t){return t===null||ss(t)?this.Cs.nu("email",t):(h.error(`Cannot set email address - "${t}" did not pass RFC-5322 validation.`),!1)}setGender(t){return typeof t=="string"&&(t=t.toLowerCase()),!(t!==null&&!ut(O.Genders,t,`Gender "${t}" is not a valid gender.`,"User.Genders"))&&this.Cs.nu("gender",t)}setDateOfBirth(t,e,s){return t===null&&e===null&&s===null?this.Cs.nu("dob",null):(t=t!=null?parseInt(t.toString()):null,e=e!=null?parseInt(e.toString()):null,s=s!=null?parseInt(s.toString()):null,t==null||e==null||s==null||isNaN(t)||isNaN(e)||isNaN(s)||e>12||e<1||s>31||s<1?(h.error("Cannot set date of birth - parameters should comprise a valid date e.g. setDateOfBirth(1776, 7, 4);"),!1):this.Cs.nu("dob",`${t}-${e}-${s}`))}setCountry(t){return!!H(t,"set country","the country",!0)&&this.Cs.nu("country",t)}setHomeCity(t){return!!H(t,"set home city","the homeCity",!0)&&this.Cs.nu("home_city",t)}setLanguage(t){return!!H(t,"set language","the language",!0)&&this.Cs.nu("language",t)}setEmailNotificationSubscriptionType(t){return!!ut(O.NotificationSubscriptionTypes,t,`Email notification setting "${t}" is not a valid subscription type.`,"User.NotificationSubscriptionTypes")&&this.Cs.nu("email_subscribe",t)}setPushNotificationSubscriptionType(t){return!!ut(O.NotificationSubscriptionTypes,t,`Push notification setting "${t}" is not a valid subscription type.`,"User.NotificationSubscriptionTypes")&&this.Cs.nu("push_subscribe",t)}setPhoneNumber(t){return!!H(t,"set phone number","the phoneNumber",!0)&&(t===null||t.match(O.Fn)?this.Cs.nu("phone",t):(h.error(`Cannot set phone number - "${t}" did not pass validation.`),!1))}setLastKnownLocation(t,e,s,i,r){return t==null||e==null?(h.error("Cannot set last-known location - latitude and longitude are required."),!1):(t=parseFloat(t.toString()),e=parseFloat(e.toString()),s!=null&&(s=parseFloat(s.toString())),i!=null&&(i=parseFloat(i.toString())),r!=null&&(r=parseFloat(r.toString())),isNaN(t)||isNaN(e)||s!=null&&isNaN(s)||i!=null&&isNaN(i)||r!=null&&isNaN(r)?(h.error("Cannot set last-known location - all supplied parameters must be numeric."),!1):t>90||t<-90||e>180||e<-180?(h.error("Cannot set last-known location - latitude and longitude are bounded by ±90 and ±180 respectively."),!1):s!=null&&s<0||r!=null&&r<0?(h.error("Cannot set last-known location - accuracy and altitudeAccuracy may not be negative."),!1):this.Cn.setLastKnownLocation(this.Cs.getUserId(),t,e,i,s,r).W)}setCustomUserAttribute(t,e,s){if(!ee(t))return!1;const i=r=>{const[o]=Ce(r,ve,"attribute value",`set custom user attribute "${t}"`,"custom user attribute");return o};if(F(e)){const[r,o]=es(t,e);if(!r&&!o&&e.length!==0)return!1;if(r||e.length===0)return this.Cn.Ln(I.$n,t,e).W;for(const l of e)if(!i(l))return!1}else if(jt(e)){if(!i(e))return!1;if(s)return this.Cn.Ln(I.Bn,t,e).W}else if(!(e!==void 0&&se(e))||(st(e)&&(e=Rt(e)),typeof e=="string"&&!nt(e,`set custom user attribute "${t}"`,"the element in the given array")))return!1;return this.Cs.setCustomUserAttribute(t,e)}addToCustomAttributeArray(t,e){return!!nt(t,"add to custom user attribute array","the given key")&&!(e!=null&&!nt(e,"add to custom user attribute array","the given value"))&&this.Cn.Ln(I.Rn,t,e).W}removeFromCustomAttributeArray(t,e){return!!nt(t,"remove from custom user attribute array","the given key")&&!(e!=null&&!nt(e,"remove from custom user attribute array","the given value"))&&this.Cn.Ln(I.On,t,e).W}incrementCustomUserAttribute(t,e){if(!nt(t,"increment custom user attribute","the given key"))return!1;e==null&&(e=1);const s=parseInt(e.toString());return isNaN(s)||s!==parseFloat(e.toString())?(h.error(`Cannot increment custom user attribute because the given incrementValue "${e}" is not an integer.`),!1):this.Cn.Ln(I.Gn,t,s).W}setCustomLocationAttribute(t,e,s){return!!nt(t,"set custom location attribute","the given key")&&((e!==null||s!==null)&&(e=e!=null?parseFloat(e.toString()):null,s=s!=null?parseFloat(s.toString()):null,e==null&&s!=null||e!=null&&s==null||e!=null&&(isNaN(e)||e>90||e<-90)||s!=null&&(isNaN(s)||s>180||s<-180))?(h.error("Received invalid values for latitude and/or longitude. Latitude and longitude are bounded by ±90 and ±180 respectively, or must both be null for removal."),!1):this.Cn.Hn(t,e,s).W)}addToSubscriptionGroup(t){return!H(t,"add user to subscription group","subscription group ID",!1)||t.length<=0?(h.error("addToSubscriptionGroup requires a non-empty subscription group ID"),!1):this.Cn.Kn(t,O.Mn.SUBSCRIBED).W}removeFromSubscriptionGroup(t){return!H(t,"remove user from subscription group","subscription group ID",!1)||t.length<=0?(h.error("removeFromSubscriptionGroup requires a non-empty subscription group ID"),!1):this.Cn.Kn(t,O.Mn.UNSUBSCRIBED).W}setLineId(t){return H(t,"set LINE user ID","the ID",!0)&&t?.length!==0?t&&t.length>O.Yn?(h.error(`Rejected LINE user ID ${t} because it is longer than ${O.Yn} characters.`),!1):this.Cs.nu("native_line_id",t):(h.error("setLineId requires a non-empty ID"),!1)}Pn(t,e,s,i,r){this.Cs.Pn(t,e,s,i,r),this.Cn.zn()}Sn(t){this.Cs.Sn(t)}}O.Genders={MALE:"m",FEMALE:"f",OTHER:"o",UNKNOWN:"u",NOT_APPLICABLE:"n",PREFER_NOT_TO_SAY:"p"},O.NotificationSubscriptionTypes={OPTED_IN:"opted_in",SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed"},O.Fn=/^[0-9 .\\(\\)\\+\\-]+$/,O.Mn={SUBSCRIBED:"subscribed",UNSUBSCRIBED:"unsubscribed"},O.Jn="user_id",O.lu="custom",O.mr=997,O.Yn=33;class Oe{constructor(){}ef(){}ff(){}Ja(t){}static nf(t,e){if(t&&e){if(t=t.toLowerCase(),F(e.cf)){for(let s=0;s<e.cf.length;s++)if(t.indexOf(e.cf[s].toLowerCase())!==-1)return e.identity}else if(t.indexOf(e.cf.toLowerCase())!==-1)return e.identity}}}const tt={rO:"Chrome",eO:"Edge",oO:"Opera",xg:"Safari",OO:"Firefox"},ct={Pg:"Android",co:"iOS",Og:"Mac",Bg:"Windows"};class ie extends Oe{constructor(){if(super(),this.userAgentData=navigator.userAgentData,this.browser=null,this.version=null,this.userAgentData){const t=this.gc();this.browser=t.browser||"Unknown Browser",this.version=t.version||"Unknown Version"}this.OS=null}ef(){return this.browser}ff(){return this.version}Ja(t){if(this.OS)return Promise.resolve(this.OS);const e=s=>{for(let i=0;i<t.length;i++){const r=ie.nf(s,t[i]);if(r)return this.OS=r,this.OS}return s};return this.userAgentData.platform?Promise.resolve(e(this.userAgentData.platform)):this.getHighEntropyValues().then(s=>s.platform?e(s.platform):navigator.platform).catch(()=>navigator.platform)}gc(){const t={},e=this.userAgentData.brands;if(e&&e.length)for(const s of e){const i=this.vc(tt),r=s.brand.match(i);if(r&&r.length>0){t.browser=r[0],t.version=s.version;break}}return t}vc(t){const e=[];for(const s in t){const i=s;e.push(t[i])}return new RegExp("("+e.join("|")+")","i")}getHighEntropyValues(){return this.userAgentData.getHighEntropyValues?this.userAgentData.getHighEntropyValues(["platform"]):Promise.reject()}}class Dt extends Oe{constructor(){super(),this.fd=Dt.gc(navigator.userAgent||"")}ef(){return this.fd[0]||"Unknown Browser"}ff(){return this.fd[1]||"Unknown Version"}Ja(t){for(let e=0;e<t.length;e++){const s=t[e].string;let i=Dt.nf(s,t[e]);if(i)return i===ct.Og&&navigator.maxTouchPoints>1&&(i=ct.co),Promise.resolve(i)}return Promise.resolve(navigator.platform)}static gc(t){let e,s=t.match(/(samsungbrowser|tizen|roku|konqueror|icab|crios|opera|ucbrowser|chrome|safari|firefox|camino|msie|trident(?=\/))\/?\s*(\.?\d+(\.\d+)*)/i)||[];if(t.indexOf("(Web0S; Linux/SmartTV)")!==-1)return["LG Smart TV",null];if(t.indexOf("CrKey")!==-1)return["Chromecast",null];if(t.indexOf("BRAVIA")!==-1||t.indexOf("SonyCEBrowser")!==-1||t.indexOf("SonyDTV")!==-1)return["Sony Smart TV",null];if(t.indexOf("PhilipsTV")!==-1)return["Philips Smart TV",null];if(t.match(/\b(Roku)\b/))return["Roku",null];if(t.match(/\bAFTM\b/))return["Amazon Fire Stick",null];if(s[1]===tt.rO&&(e=t.match(/\b(OPR|Edge|EdgA|Edg|UCBrowser)\/(\.?\d+(\.\d+)*)/),e!=null))return e=e.slice(1),e[0]=e[0].replace("OPR",tt.oO),e[0]=e[0].replace("EdgA",tt.eO),e[0]==="Edg"&&(e[0]=tt.eO),[e[0],e[1]];if(s[1]===tt.xg&&(e=t.match(/\b(EdgiOS)\/(\.?\d+(\.\d+)*)/),e!=null))return e=e.slice(1),e[0]=e[0].replace("EdgiOS",tt.eO),[e[0],e[1]];if(s=s[2]?[s[1],s[2]]:[null,null],s[0]===tt.xg&&(e=t.match(/version\/(\.?\d+(\.\d+)*)/i))!=null&&s.splice(1,1,e[1]),(e=t.match(/\b(UCBrowser)\/(\.?\d+(\.\d+)*)/))!=null&&s.splice(1,1,e[2]),s[0]===tt.oO&&(e=t.match(/mini\/(\.?\d+(\.\d+)*)/i))!=null)return["Opera Mini",e[1]||""];if(s[0]){const i=s[0].toLowerCase();i==="crios"&&(s[0]=tt.rO),i==="tizen"&&(s[0]="Samsung Smart TV",s[1]=null),i==="samsungbrowser"&&(s[0]="Samsung Browser")}return s}}class kt{constructor(){const t=navigator.userAgentData?ie:Dt;this.Sg=new t,this.userAgent=navigator.userAgent,this.browser=this.Sg.ef(),this.version=this.Sg.ff(),this.OS=null,this.Ja().then(s=>this.OS=s);const e=navigator;this.language=(e.userLanguage||e.language||e.browserLanguage||e.systemLanguage||"").toLowerCase(),this.Pa=kt.vg(this.userAgent)}bE(){return this.browser===tt.xg}Ka(){return this.OS||null}Ja(){return this.OS?Promise.resolve(this.OS):this.Sg.Ja(kt.kg).then(t=>(this.OS=t,t))}static vg(t){t=t.toLowerCase();const e=["googlebot","bingbot","slurp","duckduckbot","baiduspider","yandex","facebookexternalhit","sogou","ia_archiver","https://github.com/prerender/prerender","aolbuild","bingpreview","msnbot","adsbot","mediapartners-google","teoma","taiko","petalbot","facebookexternalhit","facebookcatalog","meta-webindexer","meta-externalads","meta-externalagent","meta-externalfetcher"];for(let s=0;s<e.length;s++)if(t.indexOf(e[s])!==-1)return!0;return!1}}kt.kg=[{string:navigator.platform,cf:"Win",identity:ct.Bg},{string:navigator.platform,cf:"Mac",identity:ct.Og},{string:navigator.platform,cf:"BlackBerry",identity:"BlackBerry"},{string:navigator.platform,cf:"FreeBSD",identity:"FreeBSD"},{string:navigator.platform,cf:"OpenBSD",identity:"OpenBSD"},{string:navigator.platform,cf:"Nintendo",identity:"Nintendo"},{string:navigator.platform,cf:"SunOS",identity:"SunOS"},{string:navigator.platform,cf:"PlayStation",identity:"PlayStation"},{string:navigator.platform,cf:"X11",identity:"X11"},{string:navigator.userAgent,cf:["iPhone","iPad","iPod"],identity:ct.co},{string:navigator.platform,cf:"Pike v",identity:ct.co},{string:navigator.userAgent,cf:["Web0S"],identity:"WebOS"},{string:navigator.userAgent,cf:"Tizen",identity:"Tizen"},{string:navigator.userAgent,cf:"Coolita",identity:"Other Smart TV"},{string:navigator.userAgent,cf:"WhaleTV",identity:"Other Smart TV"},{string:navigator.platform,cf:["Linux armv7l","Android"],identity:ct.Pg},{string:navigator.userAgent,cf:["Android"],identity:ct.Pg},{string:navigator.platform,cf:"Linux",identity:"Linux"}];const rt=new kt,d={iu:{su:"ab.storage.userId",Jh:"ab.storage.deviceId",Nl:"ab.storage.sessionId"},ct:{ec:"ab.test",tE:"ab.storage.events",eE:"ab.storage.attributes",sE:"ab.storage.attributes.anonymous_user",Qa:"ab.storage.device",au:"ab.storage.sdk_metadata",du:"ab.storage.session_id_for_cached_metadata",In:"ab.storage.pushToken",rE:"ab.storage.cardImpressions",hl:"ab.storage.serverConfig",oE:"ab.storage.triggers",nE:"ab.storage.triggers.ts",Hl:"ab.storage.messagingSessionStart",Ps:"ab.storage.cc",Gs:"ab.storage.ccLastFullSync",Hs:"ab.storage.ccLastCardUpdated",Pu:"ab.storage.globalRateLimitCurrentTokenCount",Hu:"ab.storage.dynamicRateLimitCurrentTokenCount",Et:"ab.storage.ccClicks",Pt:"ab.storage.ccImpressions",Lt:"ab.storage.ccDismissals",aE:"ab.storage.lastDisplayedTriggerTimesById",iE:"ab.storage.lastDisplayedTriggerTime",EE:"ab.storage.triggerFireInstancesById",jh:"ab.storage.signature",lE:"ab.storage.brazeSyncRetryCount",Qs:"ab.storage.sdkVersion",Ie:"ab.storage.ff",qe:"ab.storage.ffImpressions",Ae:"ab.storage.ffLastRefreshAt",Me:"ab.storage.ff.sessionId",SE:"ab.storage.lastReqToEndpoint",_E:"ab.storage.requestAttempts",Nr:"ab.storage.deferredIam",Lu:"ab.storage.lastSdkReq",uE:"ab.storage.alias",ut:"ab.storage.banners",It:"ab.storage.banners.impressions",gt:"ab.storage.banners.sessionId"},ie:"ab.optOut"};class L{constructor(t,e){this.cE=t,this.TE=e,this.cE=t,this.TE=e}Da(t){const e=lt(d.iu),s=new L.ne(t);for(const i of e)s.remove(d.iu[i])}uu(t,e){let s=null;e!=null&&e instanceof it&&(s=e.dt()),this.cE.store(t,s)}hE(t){const e=this.tu(t);e!=null&&(e.ql=new Date().valueOf(),this.uu(t,e))}tu(t){const e=this.cE.br(t),s=(r=>{let o;try{o=JSON.parse(r)}catch{o=null}return o})(e);let i;if(s)i=it.qn(s)||null,i&&this.uu(t,i);else{const r=it.AE(e);i=it.qn(r)||null,r!==e&&i&&this.uu(t,i)}return i}Fl(t){this.cE.remove(t)}Ua(){const t=lt(d.iu);let e;for(const s of t)e=this.tu(d.iu[s]),e!=null&&this.uu(d.iu[s],e)}Eo(t){let e;if(t==null||t.length===0)return!1;e=F(t)?t:[t];let s=this.TE.br(d.ct.tE);s!=null&&F(s)||(s=[]);for(let i=0;i<e.length;i++)s.push(e[i].dt());return this.TE.store(d.ct.tE,s)}yl(t){return t!=null&&this.Eo([t])}RE(){let t=this.TE.br(d.ct.tE);this.TE.remove(d.ct.tE),t==null&&(t=[]);const e=[];let s=!1,i=null;if(F(t))for(let r=0;r<t.length;r++)X.gE(t[r])?e.push(X.qn(t[r])):i=r;else s=!0;if(s||i!=null){let r="Stored events could not be deserialized as Events";s&&(r+=", was "+Object.prototype.toString.call(t)+" not an array"),i!=null&&(r+=", value at index "+i+" does not look like an event"),r+=", serialized values were of type "+typeof t+": "+JSON.stringify(t),e.push(new X(null,I.pu,new Date().valueOf(),null,{e:r}))}return e}ft(t,e){return!!ut(d.ct,t,"StorageManager cannot store object.","STORAGE_KEYS.OBJECTS")&&this.TE.store(t,e)}lt(t){return!!ut(d.ct,t,"StorageManager cannot retrieve object.","STORAGE_KEYS.OBJECTS")&&this.TE.br(t)}Nt(t){return!!ut(d.ct,t,"StorageManager cannot remove object.","STORAGE_KEYS.OBJECTS")&&(this.TE.remove(t),!0)}clearData(){const t=lt(d.iu),e=lt(d.ct);for(let s=0;s<t.length;s++){const i=t[s];this.cE.remove(d.iu[i])}for(let s=0;s<e.length;s++){const i=e[s];this.TE.remove(d.ct[i])}}OE(t){return t||d.ct.sE}ku(t){let e=this.TE.br(d.ct.eE);e==null&&(e={});const s=this.OE(t[O.Jn]),i=e[s];for(const r in t)r!==O.Jn&&(e[s]==null||i&&i[r]==null)&&this.mu(t[O.Jn],r,t[r])}mu(t,e,s){let i=this.TE.br(d.ct.eE);i==null&&(i={});const r=this.OE(t);let o=i[r];if(o==null&&(o={},t!=null&&(o[O.Jn]=t)),e===O.lu){o[e]==null&&(o[e]={});for(const l in s)o[e][l]=s[l]}else o[e]=s;return i[r]=o,this.TE.store(d.ct.eE,i)}IE(){const t=this.TE.br(d.ct.eE);this.TE.remove(d.ct.eE);const e=[];for(const s in t)t[s]!=null&&e.push(t[s]);return e}ru(t){const e=this.TE.br(d.ct.eE);if(e!=null){const o=this.OE(null),l=e[o];l!=null&&(e[o]=void 0,this.TE.store(d.ct.eE,e),l[O.Jn]=t,this.ku(l))}const s=this.tu(d.iu.Nl);let i=null;s!=null&&(i=s.eu);const r=this.RE();if(r!=null)for(let o=0;o<r.length;o++){const l=r[o];l.userId==null&&l.sessionId==i&&(l.userId=t),this.yl(l)}}dE(){return this.TE.fE}}L.rc=class{constructor(n){this.sn=n,this.sn=n,this.fE=rt.bE()?3:10}mE(n){return n+"."+this.sn}store(n,t){const e={v:t};try{return localStorage.setItem(this.mE(n),JSON.stringify(e)),!0}catch(s){return h.info("Storage failure: "+ot(s)),!1}}br(n){try{let t=null;const e=localStorage.getItem(this.mE(n));return e!=null&&(t=JSON.parse(e)),t==null?null:t.v}catch(t){return h.info("Storage retrieval failure: "+ot(t)),null}}remove(n){try{localStorage.removeItem(this.mE(n))}catch(t){return h.info("Storage removal failure: "+ot(t)),!1}}},L.ac=class{constructor(){this.KE={},this.YE=5242880,this.fE=3}store(n,t){const e={value:t},s=this.NE(t);return s>this.YE?(h.info("Storage failure: object is ≈"+s+" bytes which is greater than the max of "+this.YE),!1):(this.KE[n]=e,!0)}NE(n){const t=[],e=[n];let s=0;for(;e.length;){const i=e.pop();if(typeof i=="boolean")s+=4;else if(typeof i=="string")s+=2*i.length;else if(typeof i=="number")s+=8;else if(typeof i=="object"&&t.indexOf(i)===-1){let r,o;t.push(i);for(const l in i)o=i,r=l,e.push(o[r])}}return s}br(n){const t=this.KE[n];return t==null?null:t.value}remove(n){this.KE[n]=null}},L.ne=class{constructor(n,t){this.sn=n,this.GE=t,this.sn=n,this.CE=this.DE(),this.ME=576e3,this.GE=!!t}mE(n){return this.sn!=null?n+"."+this.sn:n}DE(){let n=0,t=document.location.hostname;const e=t.split("."),s="ab._gd";for(;n<e.length-1&&document.cookie.indexOf(s+"="+s)===-1;)n++,t="."+e.slice(-1-n).join("."),document.cookie=s+"="+s+";domain="+t+";";return document.cookie=s+"=;expires="+new Date(0).toUTCString()+";domain="+t+";",t}se(){const n=new Date;return n.setTime(n.getTime()+60*this.ME*1e3),n.getFullYear()}pE(){const n=zt(d.iu),t=document.cookie.split(";");for(let e=0;e<t.length;e++){let s=t[e];for(;s.charAt(0)===" ";)s=s.substring(1);let i=!1;for(let r=0;r<n.length;r++)if(s.indexOf(n[r])===0){i=!0;break}if(i){const r=s.split("=")[0];r.indexOf("."+this.sn)===-1&&this.vE(r)}}}store(n,t){this.pE();const e=new Date;e.setTime(e.getTime()+60*this.ME*1e3);const s="expires="+e.toUTCString(),i="domain="+this.CE;let r;r=this.GE?t:encodeURIComponent(t);const o=this.mE(n)+"="+r+";"+s+";"+i+";path=/";return o.length>=4093?(h.info("Storage failure: string is "+o.length+" chars which is too large to store as a cookie."),!1):(document.cookie=o,!0)}br(n){const t=[],e=this.mE(n)+"=",s=document.cookie.split(";");for(let i=0;i<s.length;i++){let r=s[i];for(;r.charAt(0)===" ";)r=r.substring(1);if(r.indexOf(e)===0)try{let o;o=this.GE?r.substring(e.length,r.length):decodeURIComponent(r.substring(e.length,r.length)),t.push(o)}catch(o){return h.info("Storage retrieval failure: "+ot(o)),this.remove(n),null}}return t.length>0?t[t.length-1]:null}remove(n){this.vE(this.mE(n))}vE(n){const t=n+"=;expires="+new Date(0).toUTCString();document.cookie=t,document.cookie=t+";path=/";const e=t+";domain="+this.CE;document.cookie=e,document.cookie=e+";path=/"}},L.tc=class{constructor(n,t,e){this.sn=n,this.UE=[],t&&this.UE.push(new L.ne(n)),e&&this.UE.push(new L.rc(n)),this.UE.push(new L.ac)}store(n,t){let e=!0;for(let s=0;s<this.UE.length;s++)e=this.UE[s].store(n,t)&&e;return e}br(n){for(let t=0;t<this.UE.length;t++){const e=this.UE[t].br(n);if(e!=null)return e}return null}remove(n){new L.ne(this.sn).remove(n);for(let t=0;t<this.UE.length;t++)this.UE[t].remove(n)}};class os{constructor(t,e,s){this.j=t,this.Zn=e,this.gh=s,this.j=t,this.Zn=e||!1,this.gh=s,this.ph=new $,this.Fh=0,this.kh=1}fh(){return this.Zn}wh(){return this.j.lt(d.ct.jh)}setSdkAuthenticationSignature(t){const e=this.wh();this.j.ft(d.ct.jh,t);const s=A.Us.Rs;new A(s,h).setItem(s.Fs.xh,this.kh,t),e!==t&&this.Z()}qh(){this.j.Nt(d.ct.jh);const t=A.Us.Rs;new A(t,h).be(t.Fs.xh,this.kh)}subscribeToSdkAuthenticationFailures(t){return this.gh.wt(t)}yh(t){this.gh.L(t)}Bh(){this.ph.removeAllSubscriptions()}Gh(){this.Fh+=1}Hh(){return this.Fh}Z(){this.Fh=0}}class ne{constructor(){}N(t){}changeUser(t=!1){}clearData(t=!1){}}class as{constructor(t){this.id=t,this.id=t}Ar(){const t={};return this.browser!=null&&(t.browser=this.browser),this.Ga!=null&&(t.browser_version=this.Ga),this.os!=null&&(t.os_version=this.os),this.resolution!=null&&(t.resolution=this.resolution),this.language!=null&&(t.locale=this.language),this.timeZone!=null&&(t.time_zone=this.timeZone),this.userAgent!=null&&(t.user_agent=this.userAgent),t}}const at={BROWSER:"browser",BROWSER_VERSION:"browserVersion",OS:"os",RESOLUTION:"resolution",LANGUAGE:"language",TIME_ZONE:"timeZone",USER_AGENT:"userAgent"};class ls{constructor(t,e){this.j=t,this.Fa=e,this.j=t,e==null&&(e=zt(at)),this.Fa=e}fe(t=!0){let e=this.j.tu(d.iu.Jh);e==null&&(e=new it(At.oe()),t&&this.j.uu(d.iu.Jh,e));const s=new as(e.eu);for(let i=0;i<this.Fa.length;i++)switch(this.Fa[i]){case at.BROWSER:s.browser=rt.browser;break;case at.BROWSER_VERSION:s.Ga=rt.version;break;case at.OS:s.os=this.Ja();break;case at.RESOLUTION:s.Ba=screen.width+"x"+screen.height;break;case at.LANGUAGE:s.language=rt.language;break;case at.TIME_ZONE:s.timeZone=this.Ha(new Date);break;case at.USER_AGENT:s.userAgent=rt.userAgent}return s}Ja(){if(rt.Ka())return rt.Ka();const t=this.j.lt(d.ct.Qa);return t&&t.os_version?t.os_version:rt.Ja()}Ha(t){let e=!1;if(typeof Intl<"u"&&typeof Intl.DateTimeFormat=="function")try{if(typeof Intl.DateTimeFormat().resolvedOptions=="function"){const i=Intl.DateTimeFormat().resolvedOptions().timeZone;if(i!=null&&i!=="")return i}}catch(i){h.info("Intl.DateTimeFormat threw an error, cannot detect user's time zone:"+ot(i)),e=!0}if(e)return"";const s=t.getTimezoneOffset();return this.Va(s)}Va(t){const e=Math.trunc(t/60),s=Math.trunc(t%60);let i="GMT";return t!==0&&(i+=t<0?"+":"-",i+=("00"+Math.abs(e)).slice(-2)+":"+("00"+Math.abs(s)).slice(-2)),i}}const pt={gu:"invalid_api_key",bu:"blacklisted",qu:"no_device_identifier",Ru:"invalid_json_response",vu:"empty_response",__:"sdk_auth_error"},E={H:{Tu:"data",bi:"content_cards/sync",$e:"feature_flags/sync",Ir:"template",G:"banners/sync"},Yu:n=>n?.lt(d.ct.SE),sm:n=>n?.lt(d.ct._E),nm:(n,t)=>{n?.ft(d.ct.SE,t)},rm:(n,t)=>{n?.ft(d.ct._E,t)},Cu:(n,t)=>{if(!n||!t)return-1;const e=E.Yu(n);if(e==null)return-1;const s=e[t];return s==null||isNaN(s)?-1:s},Su:(n,t)=>{let e=Kt;if(!n||!t)return e;const s=E.sm(n);return s==null?e:(e=s[t],e==null||isNaN(e)?Kt:e)},K:(n,t,e)=>{if(!n||!t)return;let s=E.Yu(n);s==null&&(s={}),s[t]=e,E.nm(n,s)},Bu:(n,t,e)=>{if(!n||!t)return;let s=E.sm(n);s==null&&(s={}),s[t]=e,E.rm(n,s)},Ci:(n,t)=>{n&&t&&E.Bu(n,t,Kt)},Ku:(n,t)=>{if(!n||!t)return;const e=E.Su(n,t);E.Bu(n,t,e+1)}},re={O:n=>{let t,e;try{const s=()=>{h.error("This browser does not have any supported ajax options!")};let i=!1;if(window.XMLHttpRequest&&(i=!0),!i)return void s();t=new XMLHttpRequest;const r=l=>{typeof n.error=="function"&&n.error(t.status),typeof n.tt=="function"&&n.tt(!1,l)};t.onload=()=>{let l=!1;if(t.readyState!==4)return;l=t.status>=200&&t.status<300||t.status===304;const u=t.getAllResponseHeaders();if(l){if(typeof n.W=="function"){let c;try{c=JSON.parse(t.responseText)}catch{const g={error:t.responseText===""?pt.vu:pt.Ru,response:t.responseText};(0,n.W)(g,u)}c&&n.W(c,u)}typeof n.tt=="function"&&n.tt(!0,u)}else r(u)},t.onerror=()=>{r(t.getAllResponseHeaders())},t.ontimeout=()=>{r()},e=JSON.stringify(n.data),t.open("POST",n.url,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-Requested-With","XMLHttpRequest");const o=n.headers||[];for(const l of o)t.setRequestHeader(l[0],l[1]);t.send(e)}catch(s){h.error(`Network request error: ${ot(s)}`)}}},us=n=>{const t={},e=n.toString().split(`\r
`);if(!e)return t;let s,i;for(const r of e)r&&(s=r.slice(0,r.indexOf(":")).toLowerCase().trim(),i=r.slice(r.indexOf(":")+1).trim(),t[s]=i);return t};class hs{constructor(t,e,s,i,r,o,l,u,c,f,g,p){this.on=t,this.j=e,this.Qh=s,this.Cs=i,this.C=r,this.h=o,this.sn=l,this.Ea=u,this.Xh=c,this.Zh=f,this.appVersion=g,this.$a=p,this.Xa=m=>m==null?"":`${m} `,this.on=t,this.j=e,this.Qh=s,this.Cs=i,this.C=r,this.h=o,this.sn=l,this.Ea=u,this.Xh=c,this.Zh=f,this.appVersion=g,this.$a=p,this.Ya=["npm"],this.Za={}}$(t,e=!1,s=!1){const i=this.on.fe(!s),r=i.Ar(),o=this.j.lt(d.ct.Qa);St(o,r)||(t.device=r),t.api_key=this.sn,t.time=qt(new Date().valueOf(),!0);const l=this.j.lt(d.ct.au)||[],u=this.j.lt(d.ct.du)||"";this.Ya.length>0&&(!St(l,this.Ya)||u!==this.C.bt())&&(t.sdk_metadata=this.Ya),t.sdk_version=this.Xh,this.Zh&&(t.sdk_flavor=this.Zh),t.app_version=this.appVersion,t.app_version_code=this.$a,t.device_id=i.id;const c=this.Cs.getUserId();if(e&&c!==null&&(t.user_id=c),!c&&!this.Qh.fh()){const f=Mt(this.j);f&&(t.alias=f)}return t}Y(t,e,s){const i=e.auth_error,r=e.error;if(!i&&!r)return!0;if(i){let o;this.Qh.Gh();const l={errorCode:i.error_code};for(const c of s)F(c)&&c[0]==="X-Braze-Auth-Signature"&&(l.signature=c[1]);t.respond_with&&t.respond_with.user_id?l.userId=t.respond_with.user_id:t.user_id&&(l.userId=t.user_id);const u=i.reason;return u?(l.reason=u,o=`due to ${u}`):o=`with error code ${i.error_code}.`,this.Qh.fh()||(o+=' Please use the "enableSdkAuthentication" initialization option to enable authentication.'),h.error(`SDK Authentication failed ${o}`),this.fu(t.events||[],t.attributes||[]),this.Qh.yh(l),!1}if(r){let o,l=r;switch(l){case pt.vu:return o="Received successful response with empty body.",Q.rt(I.pu,{e:o}),h.info(o),!1;case pt.Ru:return o="Received successful response with invalid JSON",Q.rt(I.pu,{e:o+": "+e.response}),h.info(o),!1;case pt.gu:l=`The API key "${t.api_key}" is invalid for the baseUrl ${this.Ea}`;break;case pt.bu:l="Sorry, we are not currently accepting your requests. If you think this is in error, please contact us.";break;case pt.qu:l="No device identifier. Please contact support@braze.com"}h.error("Backend error: "+l)}return!1}Au(t,e,s){return!!(t&&t.length!==0||e&&e.length!==0||s)}Du(t,e,s,i=!1){const r=[],o=v=>v||"",l=o(this.Cs.getUserId());let u=this.Mr(t);const c=[],f=[];let g,p=null;if(e.length>0){const v=[];for(const w of e){if(g=w.Ar(),this.Qh.fh()){if(l&&!g.user_id){p||(p={}),p.events||(p.events=[]),p.events.push(g);continue}if(o(g.user_id)!==l){f.push(g);continue}}v.push(g)}v.length>0&&(u.events=v)}if(s.length>0){const v=[];for(const w of s)w&&(this.Qh.fh()&&o(w.user_id)!==l?c.push(w):v.push(w));v.length>0&&(u.attributes=v)}if(this.fu(f,c),u=this.$(u,!1,i),p){p=this.$(p,!1,i);const v={requestData:p,headers:this.A(p,E.H.Tu)};r.push(v)}if(u&&!this.Au(u.events,u.attributes,t))return p?r:null;const m={requestData:u,headers:this.A(u,E.H.Tu)};return r.push(m),r}fu(t,e){if(t){const s=[];for(const i of t){const r=X.fromJson(i);r.time=Fe(r.time),s.push(r)}this.j.Eo(s)}if(e)for(const s of e)this.j.ku(s)}_(t,e){let s="HTTP error ";t!=null&&(s+=t+" "),s+=e,h.error(s)}yu(t){return Q.rt(I.wu,{n:t})}Mr(t,e){const s={};t&&(s.triggers=!0);const i=e??this.Cs.getUserId();if(i&&(s.user_id=i),!s.user_id&&!this.Qh.fh()){const r=Mt(this.j);r&&(s.alias=r)}return s.config={config_time:this.h.Ft()},{respond_with:s}}Nu(t){const e=new Date().valueOf();let s=Ge.toString();const i=E.Cu(this.j,t);return i!==-1&&(s=(e-i).toString()),s}A(t,e,s=!1){const i=[["X-Braze-Api-Key",this.sn]],r=this.Nu(e);i.push(["X-Braze-Last-Req-Ms-Ago",r]);const o=E.Su(this.j,e).toString();i.push(["X-Braze-Req-Attempt",o]);let l=!1;if(t.respond_with!=null&&t.respond_with.triggers&&(i.push(["X-Braze-TriggersRequest","true"]),l=!0),e===E.H.bi){i.push(["X-Braze-ContentCardsRequest","true"]);let u=E.Su(this.j,E.H.bi);u&&!s||(u=1,E.Bu(this.j,E.H.bi,u));const c=Math.max(0,u-1);i.push(["BRAZE-SYNC-RETRY-COUNT",c.toString()]),l=!0}if(e===E.H.$e&&(i.push(["X-Braze-FeatureFlagsRequest","true"]),l=!0),l&&i.push(["X-Braze-DataRequest","true"]),this.Qh.fh()){const u=this.Qh.wh();u!=null&&i.push(["X-Braze-Auth-Signature",u])}return i}zu(t,e,s,i){if(this.Za[i])return;const r=window.setTimeout(()=>{h.info(`Retrying rate limited ${this.Xa(i)}SDK request.`),this.J(e,s,i)},t);this.Za[i]=r}fo(){for(const t in this.Za){const e=this.Za[t];window.clearTimeout(e)}this.Za={}}J(t,e,s,i){if(!this.ju(s))return h.info(`${this.Xa(s)}SDK request being rate limited.`),void(typeof i=="function"&&i());const r=this.Mu();if(!r.$u)return this.zu(r.Xu,t,e,s),void h.info(`${this.Xa(s)}SDK request being rate limited. Request will be retried in ${Math.trunc(r.Xu/1e3)} seconds.`);this.j.ft(d.ct.Lu,new Date().valueOf());const o=t.device;o&&o.os_version instanceof Promise?o.os_version.then(l=>{t.device.os_version=l,e(r.Eu)}):e(r.Eu)}Fu(t){const e=t?us(t):null;if(!e||!e["retry-after"])return null;const s=e["retry-after"];return isNaN(s)&&!isNaN(Date.parse(s))?{type:"date",value:Date.parse(s)}:isNaN(parseFloat(s.toString()))?(Q.rt(I.pu,{e:"Received unexpected value for retry-after header in /sync response"+": "+s}),null):{type:"timestamp",value:1e3*parseFloat(s.toString())}}st(t,e,s,i,r,o){if(E.Su(this.j,s)>=Ve)return;let l;o=o||0;const u=this.Fu(t);r();const c=f=>{const g=window.setTimeout(()=>{e()},f);i(g),E.Ku(this.j,s)};if(u&&!isNaN(u.value)){switch(u.type){case"date":l=u.value-new Date().getTime()+o,l<0&&e();break;case"timestamp":l=u.value+o}c(l)}else o?c(o):E.Ci(this.j,s)}Iu(t){var e;(e=this.j)===null||e===void 0||e.ft(d.ct.Pu,t)}Uu(t,e){let s=this.xu();s==null&&(s={}),s[t]=e,this.j.ft(d.ct.Hu,s)}Ou(){var t;return(t=this.j)===null||t===void 0?void 0:t.lt(d.ct.Pu)}xu(){var t;return(t=this.j)===null||t===void 0?void 0:t.lt(d.ct.Hu)}Gu(t,e,s,i,r=""){let o;if(r){const u=this.xu();o=u==null||isNaN(u[r])?e:u[r]}else o=this.Ou(),(o==null||isNaN(o))&&(o=e);const l=(t-i)/1e3;return o=Math.min(o+l/s,e),o}_u(t,e){return Math.max(0,(1-t)*e*1e3)}Wu(t,e=""){var s,i,r,o,l;const u={$u:!0,Eu:-1,Xu:0};if(t==null&&(t=!0),!t&&!e)return u;let c,f,g=null;if(t)g=(s=this.j)===null||s===void 0?void 0:s.lt(d.ct.Lu);else{const v=E.Yu(this.j);if(v==null||v[e]==null)return u;g=v[e]}if(g==null||isNaN(g)||(t?(c=((i=this.h)===null||i===void 0?void 0:i.Ju())||-1,f=((r=this.h)===null||r===void 0?void 0:r.Qu())||-1):(c=((o=this.h)===null||o===void 0?void 0:o.Vu(e))||-1,f=((l=this.h)===null||l===void 0?void 0:l.Zu(e))||-1),c===-1||f===-1))return u;const p=new Date().valueOf();let m=this.Gu(p,c,f,g,e);return m<1?(u.$u=!1,u.Xu=this._u(m,f),u):(m=Math.trunc(m)-1,u.Eu=m,t?this.Iu(m):this.Uu(e,m),u)}Mu(){return this.Wu(!0)}ju(t){const e=this.Wu(!1,t);return!(e&&!e.$u)}Z(){this.Qh.Z()}V(){return this.Ea}addSdkMetadata(t){for(const e of t)this.Ya.indexOf(e)===-1&&this.Ya.push(e)}}const oe=(n,t)=>(n=Math.ceil(n),t=Math.floor(t),Math.floor(Math.random()*(t-n+1))+n);class It{constructor(t=!1,e=[]){this.W=t,this.ue=e,this.W=t,this.ue=e}Vt(t){this.W=this.W&&t.W,this.ue.push(...t.ue)}}const q={pn:()=>"serviceWorker"in navigator&&typeof ServiceWorkerRegistration<"u"&&"showNotification"in ServiceWorkerRegistration.prototype&&"PushManager"in window,yn:()=>"safari"in window&&"pushNotification"in window.safari&&typeof window.safari.pushNotification.permission=="function"&&typeof window.safari.pushNotification.requestPermission=="function",isPushSupported:()=>q.pn()||q.yn(),isPushBlocked:()=>{const n=q.isPushSupported()&&"Notification"in window&&window.Notification!=null&&window.Notification.permission!=null&&window.Notification.permission==="denied",t=q.isPushSupported()&&(!("Notification"in window)||window.Notification==null);return n||t},isPushPermissionGranted:()=>q.isPushSupported()&&"Notification"in window&&window.Notification!=null&&window.Notification.permission!=null&&window.Notification.permission==="granted",Qi:()=>q.isPushBlocked()?{Ui:!1,reason:"blocked"}:q.isPushSupported()?q.isPushPermissionGranted()?{Ui:!1,reason:"permissionGranted"}:{Ui:!0}:{Ui:!1,reason:"unsupported"},Vi:(n,t)=>n==="blocked"?`${t} containing a push prompt is not being shown because the user has already declined push permission prompt.`:n==="unsupported"?`${t} containing a push prompt is not being shown because the browser doesn't support push notifications.`:`${t} containing a push prompt is not being shown because the user has already accepted the permission prompt.`};class cs{constructor(t,e,s,i,r,o,l,u,c,f){this.sn=t,this.baseUrl=e,this.C=s,this.on=i,this.Cs=r,this.h=o,this.j=l,this.$l=u,this.Qh=c,this.B=f,this.sn=t,this.baseUrl=e,this.Tl=0,this.fE=l.dE()||0,this.Ll=null,this.C=s,this.on=i,this.Cs=r,this.h=o,this.j=l,this.Qh=c,this.B=f,this.$l=u,this.Ml=new $,this.Pl=null,this.Il=50,this.Ol=!1,this.Ul=!1}_l(t,e){return!t&&!e&&this.Qh.Hh()>=this.Il}Jl(t){let e=this.C.zl();if(t.length>0){const s=this.Cs.getUserId();for(const i of t){const r=!i.userId&&!s||i.userId===s;i.type===I.Al&&r&&(e=!0)}}return e}Kl(t=!1,e=!0,s,i,r,o=!1,l=!1){e&&this.Xl();const u=this.j.RE(),c=this.j.IE();let f=!1;const g=(y,T,C=-1)=>{const _=new Date().valueOf();E.K(this.j,E.H.Tu,_),C!==-1&&T.push(["X-Braze-Req-Tokens-Remaining",C.toString()]);let U=!1;re.O({url:this.baseUrl+"/data/",data:y,headers:T,W:R=>{y.respond_with!=null&&y.respond_with.triggers&&(this.Tl=Math.max(this.Tl-1,0)),this.B.Y(y,R,T)?(this.Qh.Z(),this.h.cl(R),y.respond_with!=null&&y.respond_with.user_id!=this.Cs.getUserId()||(y.device!=null&&this.j.ft(d.ct.Qa,y.device),y.sdk_metadata!=null&&(this.j.ft(d.ct.au,y.sdk_metadata),this.j.ft(d.ct.du,this.C.bt())),this.$l(R),E.Bu(this.j,E.H.Tu,1),typeof s=="function"&&s())):R.auth_error&&(U=!0)},error:()=>{U=!0,y.respond_with!=null&&y.respond_with.triggers&&(this.Tl=Math.max(this.Tl-1,0)),this.B.fu(y.events,y.attributes),typeof i=="function"&&i()},tt:(R,V)=>{typeof r=="function"&&r(!U);const B=this.B.Fu(V);let D=0;if(B)switch(B.type){case"date":D=Math.max(B.value-new Date().valueOf(),0);break;case"timestamp":D=B.value}if(e&&!f){if(U){E.Ku(this.j,E.H.Tu);let j=this.Ll;(j==null||j<1e3*this.fE)&&(j=1e3*this.fE);const K=Math.min(3e5,oe(1e3*this.fE,3*j))+D;this.Ql(K)}else this.Ql(Math.max(1e3*this.fE,D));f=!0}}})},p=this.Jl(u),m=t||p;if(this._l(o,p))return void h.info("Declining to flush data due to 50 consecutive authentication failures");if(e&&!this.B.Au(u,c,m))return this.Ql(),void(typeof r=="function"&&r(!0));const v=this.B.Du(m,u,c,l);m&&this.Tl++;let w=!1;if(v)for(const y of v)this.B.J(y.requestData,T=>g(y.requestData,y.headers,T),E.H.Tu,i),w=!0;this.Qh.fh()&&e&&!w?this.Ql():p&&(h.info("Invoking new session subscriptions"),this.Ml.L(),this.Ul=!0)}Yl(){return this.Tl>0}Ql(t=1e3*this.fE){this.Ol||(this.Xl(),this.Pl=window.setTimeout(()=>{if(document.hidden){const e="visibilitychange",s=()=>{document.hidden||(document.removeEventListener(e,s,!1),this.Kl())};document.addEventListener(e,s,!1)}else this.Kl()},t),this.Ll=t)}Xl(){this.Pl!=null&&(clearTimeout(this.Pl),this.Pl=null)}initialize(){this.Ol=!1,this.Ql()}destroy(){this.Ml.removeAllSubscriptions(),this.Qh.Bh(),this.Xl(),this.Ol=!0,this.Kl(void 0,!1,void 0,void 0,void 0,void 0,!0),this.Pl=null,this.Ul=!1}rn(t){return this.Ul?(t(),null):this.Ml.wt(t)}openSession(){const t=this.C.bt()!==this.C.qo();t&&(this.j.hE(d.iu.Jh),this.j.hE(d.iu.su)),this.Kl(!1,void 0,()=>{this.j.Nt(d.ct.qe)}),this.zn(),t&&Wt(()=>import("./hPEptUPX.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(e=>{if(this.Ol)return;const s=e.default.ea();if(s!=null&&(q.isPushPermissionGranted()||q.isPushBlocked())){const i=()=>{s.mn()?h.info("Push token maintenance is disabled, not refreshing token for backend."):s.subscribe()},r=(u,c)=>{c&&i()},o=()=>{const u=this.j.lt(d.ct.In);(u==null||u)&&i()},l=A.Us.Rs;new A(l,h).jr(l.Fs.cu,r,o)}})}Zl(){this.j.Nt(d.ct.Ie),this.j.Nt(d.ct.Ps),this.j.Nt(d.ct.Nr)}hc(){var t,e;this.j.Nt(d.ct.Lu),this.j.Nt(d.ct.SE);const s=E.H;for(const i in s){const r=s[i];this.B.Uu(r,(t=this.h)===null||t===void 0?void 0:t.Vu(r))}this.B.Iu((e=this.h)===null||e===void 0?void 0:e.Ju())}changeUser(t,e,s){const i=this.Cs.getUserId();if(i!==t){this.C.Bl(),this.Zl(),i!=null&&this.Kl(void 0,!1,void 0,void 0,void 0),this.Cs.ou(t),s?this.Qh.setSdkAuthenticationSignature(s):this.Qh.qh();for(let r=0;r<e.length;r++)e[r].changeUser(i==null);this.B.fo(),i!=null&&this.j.Nt(d.ct.rE),this.j.Nt(d.ct.Qa),this.j.Nt(d.ct.uE),this.hc(),this.openSession(),h.info('Changed user to "'+t+'".')}else{let r="Doing nothing.";s&&this.Qh.wh()!==s&&(this.Qh.setSdkAuthenticationSignature(s),r="Updated SDK authentication signature"),h.info(`Current user is already ${t}. ${r}`)}}requestImmediateDataFlush(t){this.Xl(),this.C.qo(),this.Kl(void 0,void 0,void 0,()=>{h.error("Failed to flush data, request will be retried automatically.")},t,!0)}$r(t,e){this.C.qo(),h.info("Requesting explicit trigger refresh."),this.Kl(!0,void 0,t,e)}En(t,e){const s=I.nc,i={a:t,l:e},r=Q.rt(s,i);return r&&(h.info(`Logged alias ${t} with label ${e}`),this.j.ft(d.ct.uE,i)),r}Ln(t,e,s){if(this.h.hu(e))return h.info(`Custom Attribute "${e}" is blocklisted, ignoring.`),new It;const i={key:e,value:s},r=Q.rt(t,i);if(r){const o=typeof s=="object"?JSON.stringify(s,null,2):s;h.info(`Logged custom attribute: ${e} with value: ${o}`)}return r}setLastKnownLocation(t,e,s,i,r,o){const l={latitude:e,longitude:s};i!=null&&(l.altitude=i),r!=null&&(l.ll_accuracy=r),o!=null&&(l.alt_accuracy=o);const u=Q.rt(I.lc,l,t||void 0);return u&&h.info(`Set user last known location as ${JSON.stringify(l,null,2)}`),u}kr(t,e){const s=this.C.qo();return new X(this.Cs.getUserId(),I.uc,t,s,{cid:e})}cc(t,e){return new A(t,e)}zn(){const t=A.Us.Rs;this.cc(t,h).setItem(t.Fs.Tu,1,{baseUrl:this.baseUrl,data:{api_key:this.sn,device_id:this.on.fe().id},userId:this.Cs.getUserId(),sdkAuthEnabled:this.Qh.fh()})}yr(t){for(const e of t)if(e.api_key===this.sn)this.B.fu(e.events,e.attributes);else{const s=A.Us.Rs;new A(s,h).setItem(s.Fs.wr,At.oe(),e)}}Hn(t,e,s){if(this.h.hu(t))return h.info(`Custom Attribute "${t}" is blocklisted, ignoring.`),new It;let i,r;return e===null&&s===null?(i=I.dc,r={key:t}):(i=I.mc,r={key:t,latitude:e,longitude:s}),Q.rt(i,r)}Kn(t,e){const s={group_id:t,status:e};return Q.rt(I.fc,s)}}class Nt{constructor(t=0,e=[],s=[],i=[],r=null,o=null,l={enabled:!1},u={enabled:!1,refresh_rate_limit:void 0},c={enabled:!0,capacity:qe,refill_rate:Je,endpoint_overrides:{}},f=null){this.ol=t,this.bl=e,this.fl=s,this.vl=i,this.Cl=r,this.dl=o,this.gl=l,this.he=u,this.ml=c,this.banners=f,this.ol=t,this.bl=e,this.fl=s,this.vl=i,this.Cl=r,this.dl=o,this.gl=l,this.he=u,this.ml=c,this.banners=f}dt(){return{s:"6.2.0",l:this.ol,e:this.bl,a:this.fl,p:this.vl,m:this.Cl,v:this.dl,c:this.gl,f:this.he,grl:this.ml,b:this.banners}}static qn(t){let e=t.l;return t.s!=="6.2.0"&&(e=0),new Nt(e,t.e,t.a,t.p,t.m,t.v,t.c,t.f,t.grl,t.b)}}class ds{constructor(t){this.j=t,this.j=t,this.tl=new $,this.il=new $,this.el=new $,this.sl=new $,this.rl=null,this.ul=null}al(){if(this.ul==null){const t=this.j.lt(d.ct.hl);this.ul=t!=null?Nt.qn(t):new Nt}return this.ul}Ft(){return this.al().ol}cl(t){var e,s;if(t!=null&&t.config!=null){const i=t.config;if(i.time>this.al().ol){const r=g=>g??this.al().ml,o=new Nt(i.time,i.events_blacklist,i.attributes_blacklist,i.purchases_blacklist,i.messaging_session_timeout,i.vapid_public_key,i.content_cards,i.feature_flags,r(i.global_request_rate_limit),i.banners);let l=!1;o.dl!=null&&this.Wn()!==o.dl&&(l=!0);let u=!1;o.gl.enabled!=null&&this.gi()!==o.gl.enabled&&(u=!0);let c=!1;o.he.enabled!=null&&this.Re()!==o.he.enabled&&(c=!0);let f=!1;((e=o.banners)===null||e===void 0?void 0:e.enabled)!=null&&this.Dt()!==((s=o.banners)===null||s===void 0?void 0:s.enabled)&&(f=!0),this.ul=o,this.j.ft(d.ct.hl,o.dt()),l&&this.tl.L(),u&&this.il.L(),c&&this.el.L(),f&&this.sl.L()}}}_n(t){const e=this.tl.wt(t);return this.rl&&this.tl.removeSubscription(this.rl),this.rl=e,e}vi(t){return this.il.wt(t)}Ue(t){return this.el.wt(t)}P(t){return this.sl.wt(t)}ge(t){return this.al().bl.indexOf(t)!==-1}hu(t){return this.al().fl.indexOf(t)!==-1}Dr(t){return this.al().vl.indexOf(t)!==-1}Rl(){return this.al().Cl}Wn(){return this.al().dl}gi(){return this.al().gl.enabled||!1}El(){const t=this.al().ml;return!(!t||t.enabled==null)&&t.enabled}Ju(){if(!this.El())return-1;const t=this.al().ml;return t.capacity==null||t.capacity<10?-1:t.capacity}Qu(){if(!this.El())return-1;const t=this.al().ml;return t.refill_rate==null||t.refill_rate<=0?-1:t.refill_rate}wl(t){const e=this.al().ml.endpoint_overrides;return e==null?null:e[t]}Vu(t){const e=this.wl(t);return e==null||isNaN(e.capacity)||e.capacity<=0?-1:e.capacity}Zu(t){const e=this.wl(t);return e==null||isNaN(e.refill_rate)||e.refill_rate<=0?-1:e.refill_rate}Re(){return this.al().he.enabled&&this.ke()==null?(Q.rt(I.pu,{e:"Missing feature flag refresh_rate_limit."}),!1):this.al().he.enabled||!1}ke(){return this.al().he.refresh_rate_limit}Dt(){var t;return((t=this.al().banners)===null||t===void 0?void 0:t.enabled)||null}te(){var t;return((t=this.al().banners)===null||t===void 0?void 0:t.max_placements)||0}}class fs{constructor(t,e,s,i){this.j=t,this.Cs=e,this.h=s,this.Sl=i,this.j=t,this.Cs=e,this.h=s,this.jl=1e3,(i==null||isNaN(i))&&(i=1800),i<this.jl/1e3&&(h.info("Specified session timeout of "+i+"s is too small, using the minimum session timeout of "+this.jl/1e3+"s instead."),i=this.jl/1e3),this.Sl=i}xl(t,e){return new X(this.Cs.getUserId(),I.Dl,t,e.eu,{d:qt(t-e.Gl)})}bt(){const t=this.j.tu(d.iu.Nl);return t==null?null:t.eu}zl(){const t=new Date().valueOf(),e=this.h.Rl();if(e==null)return!1;const s=this.j.lt(d.ct.Hl),i=s==null||t-s>1e3*e;return i&&this.j.ft(d.ct.Hl,t),i}Wl(t,e){return e==null||e.kl==null||!(t-e.Gl<this.jl)&&e.kl<t}qo(){const t=new Date().valueOf(),e=t+1e3*this.Sl,s=this.j.tu(d.iu.Nl);if(this.Wl(t,s)){let i="Generating session start event with time "+t;if(s!=null){let o=s.ql;o-s.Gl<this.jl&&(o=s.Gl+this.jl),this.j.yl(this.xl(o,s)),i+=" (old session ended "+o+")"}i+=". Will expire "+e.valueOf(),h.info(i);const r=new it(At.oe(),e);return this.j.yl(new X(this.Cs.getUserId(),I.Al,t,r.eu)),this.j.uu(d.iu.Nl,r),this.j.lt(d.ct.Hl)==null&&this.j.ft(d.ct.Hl,t),r.eu}if(s!=null)return s.ql=t,s.kl=e,this.j.uu(d.iu.Nl,s),s.eu}Bl(){const t=this.j.tu(d.iu.Nl);t!=null&&(this.j.Fl(d.iu.Nl),this.j.yl(this.xl(new Date().valueOf(),t)))}}const Ne={La:function(n,t=!1){let e=!1;try{if(localStorage&&localStorage.getItem)try{localStorage.setItem(d.ct.ec,"true"),localStorage.getItem(d.ct.ec)&&(localStorage.removeItem(d.ct.ec),e=!0)}catch(o){if(!(o instanceof Error&&(o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&localStorage.length>0))throw o;e=!0}}catch{h.info("Local Storage not supported!")}const s=Ne.oc(),i=new L.tc(n,s&&!t,e);let r;return r=e?new L.rc(n):new L.ac,new L(i,r)},oc:function(){return navigator.cookieEnabled||"cookie"in document&&(document.cookie.length>0||(document.cookie="test").indexOf.call(document.cookie,"test")>-1)}};class wt{constructor(t,e){this.triggerId=t,this.messageExtras=e,this.triggerId=t,this.messageExtras=e,this.extras={},this.isControl=!0,this.kt=!1}static fromJson(t){return new wt(t.trigger_id,t.message_extras)}Qt(){return!this.kt&&(this.kt=!0,!0)}Ur(){return this.kt}}function gs(n,t=!1,e=!1,s=!1){if(n==null)return!1;t=t||!1,e=e||!1;const i=n.getBoundingClientRect();return i!=null&&(i.top>=0&&i.top<=(window.innerHeight||document.documentElement.clientHeight)||!t)&&(i.left>=0||!s)&&(i.bottom>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)||!e)&&(i.right<=(window.innerWidth||document.documentElement.clientWidth)||!s)}const Ot={Ic:null,Mo:gs};function ps(){if(Ot.Ic==null){Ot.Ic=!1;try{const n=Object.defineProperty({},"passive",{get:()=>{Ot.Ic=!0}});window.addEventListener("testPassive",()=>{},n),window.removeEventListener("testPassive",()=>{},n)}catch(n){h.error(ot(n))}}return Ot.Ic}function fe(n){if(n.onclick){const t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),n.onclick.apply(n,[t])}}const ms={Oh:27},bs=n=>n!==null&&n.tagName==="IFRAME";class a{constructor(t,e,s,i,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D,j,K,ht,Z,Y,z,M,ft){this.message=t,this.messageAlignment=e,this.slideFrom=s,this.extras=i,this.triggerId=r,this.clickAction=o,this.uri=l,this.openTarget=u,this.dismissType=c,this.duration=f,this.icon=g,this.imageUrl=p,this.imageStyle=m,this.iconColor=v,this.iconBackgroundColor=w,this.backgroundColor=y,this.textColor=T,this.closeButtonColor=C,this.animateIn=_,this.animateOut=U,this.header=R,this.headerAlignment=V,this.headerTextColor=B,this.frameColor=D,this.buttons=j,this.cropType=K,this.orientation=ht,this.htmlId=Z,this.css=Y,this.messageExtras=z,this.language=M,this.altImageText=ft,this.message=t,this.messageAlignment=e||a.TextAlignment.CENTER,this.duration=f||5e3,this.slideFrom=s||a.SlideFrom.BOTTOM,this.extras=i||{},this.triggerId=r,this.clickAction=o||a.ClickAction.NONE,this.uri=l,this.openTarget=u||a.OpenTarget.NONE,this.dismissType=c||a.DismissType.AUTO_DISMISS,this.icon=g,this.imageUrl=p,this.imageStyle=m||a.ImageStyle.TOP,this.iconColor=v||a.th.ih,this.iconBackgroundColor=w||a.th.sh,this.backgroundColor=y||a.th.ih,this.textColor=T||a.th.hh,this.closeButtonColor=C||a.th.eh,this.animateIn=_,this.animateIn==null&&(this.animateIn=!0),this.animateOut=U,this.animateOut==null&&(this.animateOut=!0),this.header=R,this.headerAlignment=V||a.TextAlignment.CENTER,this.headerTextColor=B||a.th.hh,this.frameColor=D||a.th.Eh,this.buttons=j||[],this.cropType=K||a.CropType.FIT_CENTER,this.orientation=ht,this.htmlId=Z,this.css=Y,this.isControl=!1,this.messageExtras=z,this.language=M,this.altImageText=ft,this.nh=!1,this.kt=!1,this.Co=!1,this.Th=!1,this.Pe=null,this.Qe=null,this.ti=new $,this.oh=new $,this.do=a.TextAlignment.CENTER}subscribeToClickedEvent(t){return this.ti.wt(t)}subscribeToDismissedEvent(t){return this.oh.wt(t)}removeSubscription(t){this.ti.removeSubscription(t),this.oh.removeSubscription(t)}removeAllSubscriptions(){this.ti.removeAllSubscriptions(),this.oh.removeAllSubscriptions()}closeMessage(){this.ll(this.Pe)}Ve(){return!0}Bo(){return this.Ve()}Le(){return this.htmlId!=null&&this.htmlId.length>4}Oe(){return this.Le()&&this.css!=null&&this.css.length>0}Ge(){if(this.Le()&&this.Oe())return this.htmlId+"-css"}Qt(){return!this.kt&&(this.kt=!0,!0)}Ur(){return this.kt}$t(t){return!this.Co&&(this.Co=!0,this.ti.L(),!0)}Kt(){return!this.Th&&(this.Th=!0,this.oh.L(),!0)}hide(t){if(t&&t.parentNode){let e=t.closest(".ab-iam-root");if(e==null&&(e=t),this.Ve()&&e.parentNode!=null){const s=e.parentNode.classList;s&&s.contains(a.rh)&&s.remove(a.rh),document.body.removeEventListener("touchmove",a.lh)}e.className=e.className.replace(a.uh,a.ah)}return this.animateOut||!1}ll(t,e){if(t==null)return;let s;this.Pe=null,s=t.className.indexOf("ab-in-app-message")===-1?t.getElementsByClassName("ab-in-app-message")[0]:t;let i=!1;s&&(i=this.hide(s));const r=document.body;let o;r!=null&&(o=r.scrollTop);const l=()=>{if(t&&t.parentNode){let c=t.closest(".ab-iam-root");c==null&&(c=t),c.parentNode&&c.parentNode.removeChild(c)}const u=this.Ge();if(u!=null){const c=document.getElementById(u);c&&c.parentNode&&c.parentNode.removeChild(c)}r!=null&&rt.browser==="Safari"&&(r.scrollTop=o),e?e():this.Kt()};i?setTimeout(l,a.cr):l(),this.Qe&&this.Qe.focus()}ho(){return document.createTextNode(this.message||"")}bo(t){t.setAttribute("alt",this.altImageText||"")}static lh(t){if(t.targetTouches&&t.targetTouches.length>1)return;const e=t.target;e&&e.classList&&e.classList.contains("ab-message-text")&&e.scrollHeight>e.clientHeight||document.querySelector(`.${a.rh}`)&&t.cancelable&&t.preventDefault()}Ah(t){const e=t.parentNode;this.Ve()&&e!=null&&this.orientation!==a.Orientation.LANDSCAPE&&(e.classList!=null&&e.classList.add(a.rh),document.body.addEventListener("touchmove",a.lh,!!ps()&&{passive:!1})),t.className+=" "+a.uh}static Ih(t){if(t.keyCode===ms.Oh&&!b.ee(x.Lh)&&document.querySelectorAll(".ab-modal-interactions").length>0){const e=document.getElementsByClassName("ab-html-message");let s=!1;for(const i of e){let r=null;bs(i)&&i.contentWindow&&(r=i.contentWindow.document.getElementsByClassName("ab-programmatic-close-button")[0]),r!=null&&(fe(r),s=!0)}if(!s){const i=document.querySelectorAll(".ab-modal-interactions > .ab-close-button")[0];i!=null&&fe(i)}}}_h(){this.nh||b.ee(x.Lh)||(document.addEventListener("keydown",a.Ih,!1),b.mh(()=>{document.removeEventListener("keydown",a.Ih)}),this.nh=!0)}dt(t){const e={};return t&&(e[a.ss.Vr]=this.message,e[a.ss.Wr]=this.messageAlignment,e[a.ss.Nh]=this.slideFrom,e[a.ss.xs]=this.extras,e[a.ss.Yr]=this.triggerId,e[a.ss.Zr]=this.clickAction,e[a.ss.URI]=this.uri,e[a.ss.ra]=this.openTarget,e[a.ss.sa]=this.dismissType,e[a.ss.ta]=this.duration,e[a.ss.ia]=this.icon,e[a.ss.ns]=this.imageUrl,e[a.ss.oa]=this.imageStyle,e[a.ss.pa]=this.iconColor,e[a.ss.ma]=this.iconBackgroundColor,e[a.ss.na]=this.backgroundColor,e[a.ss.ua]=this.textColor,e[a.ss.ca]=this.closeButtonColor,e[a.ss.fa]=this.animateIn,e[a.ss.da]=this.animateOut,e[a.ss.la]=this.header,e[a.ss.ga]=this.headerAlignment,e[a.ss.ja]=this.headerTextColor,e[a.ss.xa]=this.frameColor,e[a.ss.za]=this.buttons,e[a.ss.ha]=this.cropType,e[a.ss.va]=this.orientation,e[a.ss.wa]=this.htmlId,e[a.ss.CSS]=this.css,e[a.ss.ts]=t,e[a.ss.ya]=this.messageExtras,e[a.ss.LANGUAGE]=this.language,e[a.ss.ks]=this.altImageText),e}}a.th={hh:4281545523,ih:4294967295,sh:4278219733,Rh:4293914607,Sh:4283782485,Eh:3224580915,eh:4288387995},a.Ye={Mh:"hd",We:"ias",Dh:"of",Ch:"do",dh:"umt",Uh:"tf",bh:"te"},a.SlideFrom={TOP:"TOP",BOTTOM:"BOTTOM"},a.ClickAction={URI:"URI",NONE:"NONE"},a.DismissType={AUTO_DISMISS:"AUTO_DISMISS",MANUAL:"SWIPE"},a.OpenTarget={NONE:"NONE",BLANK:"BLANK"},a.ImageStyle={TOP:"TOP",GRAPHIC:"GRAPHIC"},a.Orientation={PORTRAIT:"PORTRAIT",LANDSCAPE:"LANDSCAPE"},a.TextAlignment={START:"START",CENTER:"CENTER",END:"END"},a.CropType={CENTER_CROP:"CENTER_CROP",FIT_CENTER:"FIT_CENTER"},a.Ke={Kr:"SLIDEUP",Jr:"MODAL",Io:"MODAL_STYLED",Or:"FULL",Hr:"WEB_HTML",Je:"HTML",Ao:"HTML_FULL"},a.cr=500,a.Ph=200,a.uh="ab-show",a.ah="ab-hide",a.rh="ab-pause-scrolling",a.ss={Vr:"m",Wr:"ma",Nh:"sf",xs:"e",Yr:"ti",Zr:"ca",URI:"u",ra:"oa",sa:"dt",ta:"d",ia:"i",ns:"iu",oa:"is",pa:"ic",ma:"ibc",na:"bc",ua:"tc",ca:"cbc",fa:"ai",da:"ao",la:"h",ga:"ha",ja:"htc",xa:"fc",za:"b",ha:"ct",va:"o",wa:"hi",CSS:"css",ts:"type",Po:"messageFields",ya:"me",LANGUAGE:"l",ks:"ia"};class dt extends a{constructor(t,e,s,i,r,o,l,u,c,f,g,p){super(t,void 0,void 0,e,s,void 0,void 0,void 0,i=i||a.DismissType.MANUAL,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o,l,void 0,void 0,void 0,u,void 0,void 0,void 0,c,f,p,void 0,void 0),this.messageFields=g,this.messageFields=g}Bo(){return!1}$t(t){if(this.He===a.Ke.Hr){if(this.Co)return!1;this.Co=!0}return this.ti.L(t),!0}dt(){const t=super.dt(dt.es);return t[a.ss.Po]=this.messageFields,t}static Xr(t){return new dt(t[a.ss.Vr],t[a.ss.xs],t[a.ss.Yr],t[a.ss.sa],t[a.ss.ta],t[a.ss.fa],t[a.ss.da],t[a.ss.xa],t[a.ss.wa],t[a.ss.CSS],t[a.ss.Po],t[a.ss.ya])}}dt.es=a.Ke.Hr;class mt{constructor(t,e,s,i,r,o,l){this.text=t,this.backgroundColor=e,this.textColor=s,this.borderColor=i,this.clickAction=r,this.uri=o,this.id=l,this.text=t||"",this.backgroundColor=e||a.th.sh,this.textColor=s||a.th.ih,this.borderColor=i||this.backgroundColor,this.clickAction=r||a.ClickAction.NONE,this.uri=o,l==null&&(l=mt.Hi),this.id=l,this.Co=!1,this.ti=new $}subscribeToClickedEvent(t){return this.ti.wt(t)}removeSubscription(t){this.ti.removeSubscription(t)}removeAllSubscriptions(){this.ti.removeAllSubscriptions()}$t(){return!this.Co&&(this.Co=!0,this.ti.L(),!0)}static fromJson(t){return new mt(t.text,t.bg_color,t.text_color,t.border_color,t.click_action,t.uri,t.id)}}mt.Hi=-1;class bt extends a{constructor(t,e,s,i,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D,j,K,ht,Z,Y,z,M){u=u||a.DismissType.MANUAL,K=K||a.Orientation.PORTRAIT,super(t,e,void 0,s,i,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D,j=j||a.CropType.CENTER_CROP,K,ht,Z,Y,z,M),this.do=a.TextAlignment.CENTER}dt(){return super.dt(bt.es)}static Xr(t){return new bt(t[a.ss.Vr],t[a.ss.Wr],t[a.ss.xs],t[a.ss.Yr],t[a.ss.Zr],t[a.ss.URI],t[a.ss.ra],t[a.ss.sa],t[a.ss.ta],t[a.ss.ia],t[a.ss.ns],t[a.ss.oa],t[a.ss.pa],t[a.ss.ma],t[a.ss.na],t[a.ss.ua],t[a.ss.ca],t[a.ss.fa],t[a.ss.da],t[a.ss.la],t[a.ss.ga],t[a.ss.ja],t[a.ss.xa],Ie(t[a.ss.za]),t[a.ss.ha],t[a.ss.va],t[a.ss.wa],t[a.ss.CSS],t[a.ss.ya],t[a.ss.LANGUAGE],t[a.ss.ks])}}bt.es=a.Ke.Or;class vt extends a{constructor(t,e,s,i,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D,j,K,ht,Z,Y,z){super(t,e,void 0,s,i,r,o,l,u=u||a.DismissType.MANUAL,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D,j=j||a.CropType.FIT_CENTER,void 0,K,ht,Z,Y,z),this.do=a.TextAlignment.CENTER}dt(){return super.dt(vt.es)}static Xr(t){return new vt(t[a.ss.Vr],t[a.ss.Wr],t[a.ss.xs],t[a.ss.Yr],t[a.ss.Zr],t[a.ss.URI],t[a.ss.ra],t[a.ss.sa],t[a.ss.ta],t[a.ss.ia],t[a.ss.ns],t[a.ss.oa],t[a.ss.pa],t[a.ss.ma],t[a.ss.na],t[a.ss.ua],t[a.ss.ca],t[a.ss.fa],t[a.ss.da],t[a.ss.la],t[a.ss.ga],t[a.ss.ja],t[a.ss.xa],Ie(t[a.ss.za]),t[a.ss.ha],t[a.ss.wa],t[a.ss.CSS],t[a.ss.ya],t[a.ss.LANGUAGE],t[a.ss.ks])}}vt.es=a.Ke.Jr;class yt extends a{constructor(t,e,s,i,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,U,R,V,B,D){y=y||a.th.Sh,w=w||a.th.Rh,super(t,e=e||a.TextAlignment.START,s,i,r,o,l,u,c,f,g,p,void 0,m,v,w,y,T,C,_,void 0,void 0,void 0,void 0,void 0,void 0,void 0,U,R,V,B,D),this.do=a.TextAlignment.START}Ve(){return!1}ho(){const t=document.createElement("span");return t.appendChild(document.createTextNode(this.message||"")),t}Ah(t){const e=t.getElementsByClassName("ab-in-app-message")[0];Ot.Mo(e,!0,!0)||(this.slideFrom===a.SlideFrom.TOP?e.style.top="0px":e.style.bottom="0px"),super.Ah(t)}dt(){return super.dt(yt.es)}static Xr(t){return new yt(t[a.ss.Vr],t[a.ss.Wr],t[a.ss.Nh],t[a.ss.xs],t[a.ss.Yr],t[a.ss.Zr],t[a.ss.URI],t[a.ss.ra],t[a.ss.sa],t[a.ss.ta],t[a.ss.ia],t[a.ss.ns],t[a.ss.pa],t[a.ss.ma],t[a.ss.na],t[a.ss.ua],t[a.ss.ca],t[a.ss.fa],t[a.ss.da],t[a.ss.wa],t[a.ss.CSS],t[a.ss.ya],t[a.ss.LANGUAGE],t[a.ss.ks])}}yt.es=a.Ke.Kr;function ke(n){if(!n)return null;if(n.is_control)return wt.fromJson(n);let t=n.type;t!=null&&(t=t.toUpperCase());const e=n.message,s=n.text_align_message,i=n.slide_from,r=n.extras,o=n.trigger_id,l=n.click_action,u=n.uri,c=n.open_target,f=n.message_close,g=n.duration,p=n.icon,m=n.image_url,v=n.image_style,w=n.icon_color,y=n.icon_bg_color,T=n.bg_color,C=n.text_color,_=n.close_btn_color,U=n.header,R=n.text_align_header,V=n.header_text_color,B=n.frame_color,D=[];let j=n.btns;j==null&&(j=[]);for(let Tt=0;Tt<j.length;Tt++)D.push(mt.fromJson(j[Tt]));const K=n.crop_type,ht=n.orientation,Z=n.animate_in,Y=n.animate_out;let z=n.html_id,M=n.css;z!=null&&z!==""&&M!=null&&M!==""||(z=void 0,M=void 0);const ft=n.message_extras,Jt=n.language,Gt=n.image_alt;let gt;if(t===vt.es||t===a.Ke.Io)gt=new vt(e,s,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,Z,Y,U,R,V,B,D,K,z,M,ft,Jt,Gt);else if(t===bt.es)gt=new bt(e,s,r,o,l,u,c,f,g,p,m,v,w,y,T,C,_,Z,Y,U,R,V,B,D,K,ht,z,M,ft,Jt,Gt);else if(t===yt.es)gt=new yt(e,s,i,r,o,l,u,c,f,g,p,m,w,y,T,C,_,Z,Y,z,M,ft,Jt,Gt);else{if(t!==dt.es&&t!==a.Ke.Je&&t!==a.Ke.Ao)return void h.error("Ignoring message with unknown type "+t);{const Tt=n.message_fields;gt=new dt(e,r,o,f,g,Z,Y,B,z,M,Tt,ft),gt.trusted=n.trusted||!1}}return gt.He=t,gt}function Ie(n){const t=[];for(const e of n)t.push(new mt(e.text,e.backgroundColor,e.textColor,e.borderColor,e.clickAction,e.uri,e.id));return t}class xt{constructor(t){this.wc=t,this.wc=t}xc(t){return this.wc==null||this.wc===t[0]}static fromJson(t){return new xt(t?t.event_name:null)}dt(){return this.wc}}class N{constructor(t,e,s,i){this.yE=t,this.HE=e,this.comparator=s,this.LE=i,this.yE=t,this.HE=e,this.comparator=s,this.LE=i,this.HE===N.XE.QE&&this.comparator!==N.BE.wE&&this.comparator!==N.BE.jE&&this.comparator!==N.BE.zE&&this.comparator!==N.BE.FE&&(this.LE=Qt(this.LE))}xc(t){let e=null;switch(t!=null&&(e=t[this.yE]),this.comparator){case N.BE.kE:return e!=null&&e.valueOf()===this.LE.valueOf();case N.BE.xE:return e==null||e.valueOf()!==this.LE.valueOf();case N.BE.JE:return e!=null&&typeof e==typeof this.LE&&e>this.LE;case N.BE.wE:return this.HE===N.XE.QE?e!=null&&st(e)&&ce(e)<=this.LE.valueOf():e!=null&&typeof e==typeof this.LE&&e>=this.LE;case N.BE.VE:return e!=null&&typeof e==typeof this.LE&&e<this.LE;case N.BE.jE:return this.HE===N.XE.QE?e!=null&&st(e)&&ce(e)>=this.LE.valueOf():e!=null&&typeof e==typeof this.LE&&e<=this.LE;case N.BE.qE:return e!=null&&typeof e=="string"&&typeof e==typeof this.LE&&e.match(this.LE)!=null;case N.BE.PE:return e!=null;case N.BE.WE:return e==null;case N.BE.zE:return e!=null&&st(e)&&de(e)<this.LE;case N.BE.FE:return e!=null&&st(e)&&de(e)>this.LE;case N.BE.ZE:return e==null||typeof e!=typeof this.LE||typeof e!="string"||e.match(this.LE)==null}return!1}static fromJson(t){return new N(t.property_key,t.property_type,t.comparator,t.property_value)}dt(){let t=this.LE;return st(this.LE)&&(t=qt(t.valueOf())),{k:this.yE,t:this.HE,c:this.comparator,v:t}}static qn(t){return new N(t.k,t.t,t.c,t.v)}}N.XE={$E:"boolean",tT:"number",sT:"string",QE:"date"},N.BE={kE:1,xE:2,JE:3,wE:4,VE:5,jE:6,qE:10,PE:11,WE:12,zE:15,FE:16,ZE:17};class Et{constructor(t){this.filters=t,this.filters=t}xc(t){let e=!0;for(let s=0;s<this.filters.length;s++){const i=this.filters[s];let r=!1;for(let o=0;o<i.length;o++)if(i[o].xc(t)){r=!0;break}if(!r){e=!1;break}}return e}static fromJson(t){if(t==null||!F(t))return null;const e=[];for(let s=0;s<t.length;s++){const i=[],r=t[s];for(let o=0;o<r.length;o++)i.push(N.fromJson(r[o]));e.push(i)}return new Et(e)}dt(){const t=[];for(let e=0;e<this.filters.length;e++){const s=this.filters[e],i=[];for(let r=0;r<s.length;r++)i.push(s[r].dt());t.push(i)}return t}static qn(t){const e=[];for(let s=0;s<t.length;s++){const i=[],r=t[s];for(let o=0;o<r.length;o++)i.push(N.qn(r[o]));e.push(i)}return new Et(e)}}class Lt{constructor(t,e){this.wc=t,this.tf=e,this.wc=t,this.tf=e}xc(t){if(this.wc==null||this.tf==null)return!1;const e=t[0],s=t[1];return e===this.wc&&this.tf.xc(s)}static fromJson(t){return new Lt(t?t.event_name:null,t?Et.fromJson(t.property_filters):null)}dt(){return{e:this.wc,pf:this.tf?this.tf.dt():null}}}class Ut{constructor(t,e){this.if=t,this.rf=e,this.if=t,this.rf=e}xc(t){if(this.if==null)return!1;const e=S.sf(t[0],this.if);if(!e)return!1;let s=this.rf==null||this.rf.length===0;if(this.rf!=null){for(let i=0;i<this.rf.length;i++)if(this.rf[i]===t[1]){s=!0;break}}return e&&s}static fromJson(t){return new Ut(t?t.id:null,t?t.buttons:null)}dt(){return this.if}}class Pt{constructor(t){this.productId=t,this.productId=t}xc(t){return this.productId==null||t[0]===this.productId}static fromJson(t){return new Pt(t?t.product_id:null)}dt(){return this.productId}}class $t{constructor(t,e){this.productId=t,this.tf=e,this.productId=t,this.tf=e}xc(t){if(this.productId==null||this.tf==null)return!1;const e=t[0],s=t[1];return e===this.productId&&this.tf.xc(s)}static fromJson(t){return new $t(t?t.product_id:null,t?Et.fromJson(t.property_filters):null)}dt(){return{id:this.productId,pf:this.tf?this.tf.dt():null}}}class Ft{constructor(t){this.if=t,this.if=t}xc(t){return this.if==null||S.sf(t[0],this.if)}static fromJson(t){return new Ft(t?t.campaign_id:null)}dt(){return this.if}}const J={OPEN:"open",Rr:"purchase",vr:"push_click",pe:"custom_event",Qr:"iam_click",qs:"test"};class S{constructor(t,e){this.type=t,this.data=e,this.type=t,this.data=e}kc(t,e){return S._c[this.type]===t&&(this.data==null||this.data.xc(e))}static sf(t,e){let s=null;try{s=window.atob(t)}catch(i){return h.info("Failed to unencode analytics id "+t+": "+ot(i)),!1}return e===s.split("_")[0]}static fromJson(t){const e=t.type;let s=null;switch(e){case S._r.OPEN:case S._r.qs:break;case S._r.Rr:s=Pt.fromJson(t.data);break;case S._r.bc:s=$t.fromJson(t.data);break;case S._r.vr:s=Ft.fromJson(t.data);break;case S._r.pe:s=xt.fromJson(t.data);break;case S._r.Ec:s=Lt.fromJson(t.data);break;case S._r.Qr:s=Ut.fromJson(t.data)}return new S(e,s)}dt(){return{t:this.type,d:this.data?this.data.dt():null}}static qn(t){let e,s=null;switch(t.t){case S._r.OPEN:case S._r.qs:break;case S._r.Rr:s=new Pt(t.d);break;case S._r.bc:e=t.d||{},s=new $t(e.id,Et.qn(e.pf||[]));break;case S._r.vr:s=new Ft(t.d);break;case S._r.pe:s=new xt(t.d);break;case S._r.Ec:e=t.d||{},s=new Lt(e.e,Et.qn(e.pf||[]));break;case S._r.Qr:s=new Ut(t.d)}return new S(t.t,s)}}S._r={OPEN:"open",Rr:"purchase",bc:"purchase_property",vr:"push_click",pe:"custom_event",Ec:"custom_event_property",Qr:"iam_click",qs:"test"},S._c={},S._c[S._r.OPEN]=J.OPEN,S._c[S._r.Rr]=J.Rr,S._c[S._r.bc]=J.Rr,S._c[S._r.vr]=J.vr,S._c[S._r.pe]=J.pe,S._c[S._r.Ec]=J.pe,S._c[S._r.Qr]=J.Qr,S._c[S._r.qs]=J.qs;class G{constructor(t,e=[],s,i,r=0,o,l,u=0,c=G.td,f,g,p){this.id=t,this.sd=e,this.startTime=s,this.endTime=i,this.priority=r,this.type=o,this.data=l,this.ed=u,this.rd=c,this.Gr=f,this.hd=g,this.od=p,this.id=t,this.sd=e||[],s===void 0&&(s=null),this.startTime=s,i===void 0&&(i=null),this.endTime=i,this.priority=r||0,this.type=o,this.ed=u||0,f==null&&(f=1e3*(this.ed+30)),this.Gr=f,this.data=l,c!=null&&(this.rd=c),this.hd=g,this.od=p||null}nd(t){return this.od==null||this.rd!==G.td&&t-this.od>=1e3*this.rd}ad(t){this.od=t}ud(t){const e=t+1e3*this.ed;return Math.max(e-new Date().valueOf(),0)}dd(t){const e=new Date().valueOf()-t,s=t==null||isNaN(e)||this.Gr==null||e<this.Gr;return s||h.info(`Trigger action ${this.type} is no longer eligible for display - fired ${e}ms ago and has a timeout of ${this.Gr}ms.`),!s}static fromJson(t){const e=t.id,s=[];for(let m=0;m<t.trigger_condition.length;m++)s.push(S.fromJson(t.trigger_condition[m]));const i=Qt(t.start_time),r=Qt(t.end_time),o=t.priority,l=t.type,u=t.delay,c=t.re_eligibility,f=t.timeout,g=t.data,p=t.min_seconds_since_last_trigger;return ut(G._r,l,"Could not construct Trigger from server data","Trigger.Types")?new G(e,s,i,r,o,l,g,u,c,f,p):null}dt(){const t=[];for(let e=0;e<this.sd.length;e++)t.push(this.sd[e].dt());return{i:this.id,c:t,s:this.startTime,e:this.endTime,p:this.priority,t:this.type,da:this.data,d:this.ed,r:this.rd,tm:this.Gr,ss:this.hd,ld:this.od}}static qn(t){const e=[],s=t.c||[];for(let i=0;i<s.length;i++)e.push(S.qn(s[i]));return new G(t.i,e,Xt(t.s),Xt(t.e),t.p,t.t,t.da,t.d,t.r,t.tm,t.ss,t.ld)}}G._r={Br:"inapp",md:"templated_iam"},G.td=-1;const Ct={PORTRAIT:0,LANDSCAPE:1};function vs(){return screen.width<=600}function ys(){if("orientation"in window)return Math.abs(window.orientation)===90||window.orientation===270?Ct.LANDSCAPE:Ct.PORTRAIT;const n=window;if("screen"in n){let t=n.screen.orientation||screen.mozOrientation||screen.msOrientation;return t!=null&&typeof t=="object"&&(t=t.type),t==="landscape-primary"||t==="landscape-secondary"?Ct.LANDSCAPE:Ct.PORTRAIT}return Ct.PORTRAIT}function Es(n,t,e){n&&(t||e!=null&&e.metaKey?window.open(n):window.location=n)}function ws(){return window.location.href}const Ss={openUri:Es,Uo:vs,$o:ys,Ca:ws};function ge(){if(b.rr())return b.gr()}function Ts(n){n==null&&(n="");const t=n.split("?").slice(1).join("?"),e={};if(t!=null){const s=t.split("&");for(let i=0;i<s.length;i++){const r=s[i].split("=");r[0]!==""&&(e[r[0]]=r[1])}}return e}class Cs{constructor(t,e,s,i){this.B=t,this.C=e,this.j=s,this.Cs=i,this.B=t,this.C=e,this.j=s,this.Cs=i,this.yi=new $,b.q(this.yi),this.Mi=1e3,this.ki=6e4,this.zi=null,this.Bi=null,this.Ri=null}_i(){return this.yi}qi(t){return this.yi.wt(t)}xi(){return this.zi}Pi(t){this.zi=t}rt(t,e,s,i){const r=new It;let o;if(e===I.Gi||t instanceof wt){if(!t.Qt())return h.info("This in-app message has already received an impression. Ignoring analytics event."),r}else if((e===I.$i||t instanceof dt&&e===I.Fi)&&!t.$t(i))return h.info("This in-app message has already received a click. Ignoring analytics event."),r;return o=t instanceof wt?{trigger_ids:[t.triggerId]}:this.Oi(t),o==null?r:(t.messageExtras&&(o.message_extras=t.messageExtras),s!=null&&(o.bid=s),Q.rt(e,o))}Xi(t,e){const s=new It;if(!t.$t())return h.info("This in-app message button has already received a click. Ignoring analytics event."),s;const i=this.Oi(e);return i==null?s:t.id===mt.Hi?(h.info("This in-app message button does not have a tracking id. Not logging event to Braze servers."),s):(t.id!=null&&(i.bid=t.id),Q.rt(I.Fi,i))}Ji(t){const e=t.messageFields;return e!=null&&e.is_push_primer||!1}Ki(t){if(!(t instanceof a))return;const e=r=>{if(!r)return;const o=We(r);if(Se(o))return He(Ee.Li,"In-App Message");if(Te(o)){const l=q.Qi();if(!l.Ui)return q.Vi(l.reason,"In-App Message")}};if(this.Ji(t)){const r=q.Qi();if(!r.Ui)return q.Vi(r.reason,"In-App Message")}const s=t.buttons||[];let i;for(const r of s)if(r.clickAction===a.ClickAction.URI&&r.uri&&Zt.test(r.uri)&&(i=e(r.uri),i))return i;return t.clickAction===a.ClickAction.URI&&t.uri&&Zt.test(t.uri)?e(t.uri):void 0}Wi(t,e){e!==this.Ri&&this.Yi(),this.Bi=t,this.Ri=e}Yi(){this.Bi!=null&&(clearTimeout(this.Bi),this.Bi=null,this.Ri=null)}Zi(t,e,s,i){const r=this.B;if(!r)return;this.Ri&&t.triggerId!==this.Ri&&(this.Yi(),E.Ci(this.j,E.H.Ir));const o=r.Mr(!1),l=r.$(o);l.template={trigger_id:t.triggerId,trigger_event_type:e},s!=null&&(l.template.data=s.Ar());const u=r.A(l,E.H.Ir);r.J(l,(c=-1)=>{const f=this.B;if(!f)return;const g=new Date().valueOf();E.K(this.j,E.H.Ir,g),c!==-1&&u.push(["X-Braze-Req-Tokens-Remaining",c.toString()]);let p,m,v=!1;re.O({url:`${f.V()}/template/`,data:l,headers:u,W:w=>{if(!f.Y(l,w,u))return void(typeof t.Tr=="function"&&t.Tr());if(f.Z(),w==null||w.templated_message==null)return;const y=w.templated_message;if(y.type!==G._r.Br)return;const T=ke(y.data);if(T==null)return;const C=this.Ki(T);if(C)return h.error(C),void(typeof t.Tr=="function"&&t.Tr());typeof t.qr=="function"&&t.qr(T)},error:w=>{v=!0,p=w,m=`getting user personalization for message ${t.triggerId}.`},tt:(w,y)=>{if(new Date().valueOf()-t.Er<t.Gr){let T=0;if(v){const C=Math.min(t.Gr,this.ki),_=this.Mi;i==null&&(i=_),T=Math.min(C,oe(_,3*i))}f.st(y,()=>{this.Zi(t,e,s,T)},E.H.Ir,C=>this.Wi(C,t.triggerId),()=>this.Yi(),T)}v&&f._(p,m)}})},E.H.Ir)}Oi(t){if(t.triggerId==null)return h.info("The in-app message has no analytics id. Not logging event to Braze servers."),null;const e={};return t.triggerId!=null&&(e.trigger_ids=[t.triggerId]),e}Ee(t){return!!this.j&&!(!(t&&t instanceof a&&t.constructor!==a)||t instanceof wt)&&this.j.ft(d.ct.Nr,t.dt())}zr(){if(!this.j)return null;const t=this.j.lt(d.ct.Nr);if(!t)return null;let e;switch(t.type){case a.Ke.Or:e=bt.Xr(t);break;case a.Ke.Hr:case a.Ke.Je:case a.Ke.Ao:e=dt.Xr(t);break;case a.Ke.Jr:case a.Ke.Io:e=vt.Xr(t);break;case a.Ke.Kr:e=yt.Xr(t)}return e&&this.Lr(),e}Lr(){this.j&&this.j.Nt(d.ct.Nr)}}const et={aa:null,i:!1,ea:()=>(et.t(),et.aa||(et.aa=new Cs(b.m(),b.u(),b.p(),b.ir())),et.aa),t:()=>{et.i||(b.g(et),et.i=!0)},destroy:()=>{et.aa=null,et.i=!1}};class ae{constructor(t,e,s,i,r){this.triggerId=t,this.qr=e,this.Tr=s,this.Er=i,this.Gr=r,this.triggerId=t,this.qr=e,this.Tr=s,this.Er=i,this.Gr=r}static fromJson(t,e,s,i,r){return t==null||t.trigger_id==null?null:new ae(t.trigger_id,e,s,i,r)}}class Os extends ne{constructor(t,e,s,i,r){super(),this.tg=t,this.ws=e,this.j=s,this.Cn=i,this.ig=r,this.tg=t,this.ws=e,this.j=s,this.Cn=i,this.ig=r,this.sg=[],this.eg=[],this.hg=null,this.ng={},this.og={},this.triggers=[],this.lg=0,this.ag(),this.gg()}fg(){if(this.j){this.hg=this.j.lt(d.ct.iE)||this.hg,this.ng=this.j.lt(d.ct.EE)||this.ng,this.og=this.j.lt(d.ct.aE)||this.og;for(let t=0;t<this.triggers.length;t++){const e=this.triggers[t];e.id&&this.og[e.id]!=null&&e.ad(this.og[e.id])}}}ag(){if(!this.j)return;this.lg=this.j.lt(d.ct.nE)||0;const t=this.j.lt(d.ct.oE)||[],e=[];for(let s=0;s<t.length;s++)e.push(G.qn(t[s]));this.triggers=e,this.fg()}gg(){const t=this,e=function(r,o,l,u,c){return function(){t.cg(r,o,l,u,c)}},s={};for(const r of this.triggers)r.id&&(s[r.id]=r);let i=!1;for(let r=0;r<this.triggers.length;r++){const o=this.triggers[r];if(o.id&&this.ng[o.id]!=null){const l=this.ng[o.id],u=[];for(let c=0;c<l.length;c++){const f=l[c],g=o.ud(f.Er||0);if(g>0){let p,m;u.push(f),f.ug!=null&&(p=f.ug),f.dg!=null&&X.gE(f.dg)&&(m=X.qn(f.dg));const v=[];if(f.pg&&F(f.pg))for(let w=0;w<f.pg.length;w++){const y=s[f.pg[w]];y!=null&&v.push(y)}this.eg.push(window.setTimeout(e(o,f.Er||0,p,m,v),g))}}this.ng[o.id].length>u.length&&(this.ng[o.id]=u,i=!0,this.ng[o.id].length===0&&delete this.ng[o.id])}}i&&this.j&&this.j.ft(d.ct.EE,this.ng)}mg(){if(!this.j)return;const t=[];for(let e=0;e<this.triggers.length;e++)t.push(this.triggers[e].dt());this.lg=new Date().valueOf(),this.j.ft(d.ct.oE,t),this.j.ft(d.ct.nE,this.lg)}bg(){this.j&&((this.j.lt(d.ct.nE)||0)>this.lg?this.ag():this.fg())}N(t){let e=!1;if(t!=null&&t.triggers){this.ig.Lr(),this.fg();const s={},i={};this.triggers=[];for(let l=0;l<t.triggers.length;l++){const u=G.fromJson(t.triggers[l]);if(u){u.id&&this.og[u.id]!=null&&(u.ad(this.og[u.id]),s[u.id]=this.og[u.id]),u.id&&this.ng[u.id]!=null&&(i[u.id]=this.ng[u.id]);for(let c=0;c<u.sd.length;c++)if(u.sd[c].kc(J.qs,null)){e=!0;break}this.triggers.push(u)}}St(this.og,s)||(this.og=s,this.j&&this.j.ft(d.ct.aE,this.og)),St(this.ng,i)||(this.ng=i,this.j&&this.j.ft(d.ct.EE,this.ng)),this.mg(),e&&(h.info("Trigger with test condition found, firing test."),this.ve(J.qs)),this.ve(J.OPEN);const r=this.sg;let o;this.sg=[];for(let l=0;l<r.length;l++)o=Array.prototype.slice.call(r[l]),this.ve(...o)}}cg(t,e,s,i,r){const o=g=>{this.fg();const p=new Date().valueOf();t.dd(e)||(navigator.onLine===!1&&t.type===G._r.Br&&g.imageUrl?h.info(`Not showing ${t.type} trigger action ${t.id} due to offline state.`):t.nd(p)&&this.wg(t,p,s)?this.ws.sc()===0?h.info(`Not displaying trigger ${t.id} because neither automaticallyShowInAppMessages() nor subscribeToInAppMessage() were called.`):(this.ws.L([g]),this.yg(t,p)):h.info(`Not displaying trigger ${t.id} because display time fell outside of the acceptable time window.`))},l=()=>{this.fg();const g=r.pop();if(g!=null)if(this.Tg(g,e,s,i,r),g.dd(e)){let p=`Server aborted in-app message display, but the timeout on fallback trigger ${g.id} has already elapsed.`;r.length>0&&(p+=" Continuing to fall back."),h.info(p),l()}else{h.info(`Server aborted in-app message display. Falling back to lower priority ${g.type} trigger action ${t.id}.`);const p=1e3*g.ed-(new Date().valueOf()-e);p>0?this.eg.push(window.setTimeout(()=>{this.cg(g,e,s,i,r)},p)):this.cg(g,e,s,i,r)}};let u,c,f;switch(t.type){case G._r.Br:if(u=ke(t.data),u==null){h.error(`Could not parse trigger data for trigger ${t.id}, ignoring.`);break}if(c=this.ig.Ki(u),c){h.error(c),l();break}o(u);break;case G._r.md:if(f=ae.fromJson(t.data,o,l,e,t.Gr||0),f==null){h.error(`Could not parse trigger data for trigger ${t.id}, ignoring.`);break}this.ig.Zi(f,s,i);break;default:h.error(`Trigger ${t.id} was of unexpected type ${t.type}, ignoring.`)}}ve(t,e=null,s){if(!ut(J,t,"Cannot fire trigger action.","TriggerEvents"))return;if(this.Cn&&this.Cn.Yl())return h.info("Trigger sync is currently in progress, awaiting sync completion before firing trigger event."),void this.sg.push(arguments);this.bg();const i=new Date().valueOf(),r=i-(this.hg||0);let o=!0,l=!0;const u=[];for(let f=0;f<this.triggers.length;f++){const g=this.triggers[f],p=i+1e3*g.ed;if(g.nd(p)&&(g.startTime==null||g.startTime.valueOf()<=i)&&(g.endTime==null||g.endTime.valueOf()>=i)){let m=!1;for(let v=0;v<g.sd.length;v++)if(g.sd[v].kc(t,e)){m=!0;break}m&&(o=!1,this.wg(g,p,t)&&(l=!1,u.push(g)))}}if(o)return void h.info(`Trigger event ${t} did not match any trigger conditions.`);if(l)return void h.info(`Ignoring ${t} trigger event because a trigger was displayed ${r/1e3}s ago.`);u.sort((f,g)=>f.priority-g.priority);const c=u.pop();c!=null&&(h.info(`Firing ${c.type} trigger action ${c.id} from trigger event ${t}.`),this.Tg(c,i,t,s,u),c.ed===0?this.cg(c,i,t,s,u):this.eg.push(window.setTimeout(()=>{this.cg(c,i,t,s,u)},1e3*c.ed)))}changeUser(t=!1){if(this.triggers=[],this.j&&this.j.Nt(d.ct.oE),!t){this.sg=[],this.hg=null,this.og={},this.ng={};for(let e=0;e<this.eg.length;e++)clearTimeout(this.eg[e]);this.eg=[],this.j&&(this.j.Nt(d.ct.iE),this.j.Nt(d.ct.aE),this.j.Nt(d.ct.EE))}}clearData(){this.triggers=[],this.hg=null,this.og={},this.ng={};for(let t=0;t<this.eg.length;t++)clearTimeout(this.eg[t]);this.eg=[]}wg(t,e,s){if(this.hg==null)return!0;if(s===J.qs)return h.info("Ignoring minimum interval between trigger because it is a test type."),!0;let i=t.hd;return i==null&&(i=this.tg),e-this.hg>=1e3*i}Tg(t,e,s,i,r){this.fg(),t.id&&(this.ng[t.id]=this.ng[t.id]||[]);const o={};let l;o.Er=e,o.ug=s,i!=null&&(l=i.dt()),o.dg=l;const u=[];for(const c of r)c.id&&u.push(c.id);o.pg=u,t.id&&this.ng[t.id].push(o),this.j&&this.j.ft(d.ct.EE,this.ng)}yg(t,e){this.fg(),t.ad(e),this.hg=e,t.id&&(this.og[t.id]=e),this.j&&(this.j.ft(d.ct.iE,e),this.j.ft(d.ct.aE,this.og))}}const P={i:!1,provider:null,o:()=>(P.t(),P.provider||P.rg(),P.provider),rg:()=>{if(!P.provider){const n=b.ee(x.Zo);P.provider=new Os(n??30,et.ea()._i(),b.p(),b.nn(),et.ea()),b.v(P.provider)}},t:()=>{P.i||(P.rg(),b.g(P),P.i=!0)},destroy:()=>{P.provider=null,P.i=!1}};class le{constructor(t,e,s,i,r){this.endpoint=t,this.Vn=e,this.publicKey=s,this.Vl=i,this.dl=r,this.endpoint=t||null,this.Vn=e||null,this.publicKey=s||null,this.Vl=i||null,this.dl=r||null}dt(){return{e:this.endpoint,c:this.Vn,p:this.publicKey,u:this.Vl,v:this.dl}}static qn(t){return new le(t.e,Xt(t.c),t.p,t.u,t.v)}}class Ns{constructor(t,e){this.h=t,this.j=e,this.h=t,this.j=e}getUserId(){const t=this.j.tu(d.iu.su);if(t==null)return null;let e=t.eu,s=Bt(e);if(s>O.mr){for(;s>O.mr;)e=e.slice(0,e.length-1),s=Bt(e);t.eu=e,this.j.uu(d.iu.su,t)}return e}ou(t){const e=this.getUserId()==null;this.j.uu(d.iu.su,new it(t)),e&&this.j.ru(t)}setCustomUserAttribute(t,e){if(this.h.hu(t))return h.info('Custom Attribute "'+t+'" is blocklisted, ignoring.'),!1;const s={};return s[t]=e,this.nu(O.lu,s,!0)}nu(t,e,s=!1,i=!1){const r=this.j.mu(this.getUserId(),t,e);let o="",l=t,u=e;return s&&(o=" custom",typeof e=="object"&&(l=Object.keys(e)[0],u=e[l],typeof u=="object"&&(u=JSON.stringify(u,null,2)))),!i&&r&&h.info(`Logged${o} attribute ${l} with value ${u}`),r}Pn(t,e,s,i,r){this.nu("push_token",t,!1,!0),this.nu("custom_push_public_key",s,!1,!0),this.nu("custom_push_user_auth",i,!1,!0),this.nu("custom_push_vapid_public_key",r,!1,!0);const o=A.Us.Rs,l=new A(o,h),u=new le(t,e,s,i,r);this.j.ft(d.ct.In,u.dt()),l.setItem(o.Fs.cu,o.me,!0)}Sn(t){if(this.nu("push_token",null,!1,!0),this.nu("custom_push_public_key",null,!1,!0),this.nu("custom_push_user_auth",null,!1,!0),this.nu("custom_push_vapid_public_key",null,!1,!0),t){const e=A.Us.Rs,s=new A(e,h);this.j.ft(d.ct.In,!1),s.setItem(e.Fs.cu,e.me,!1)}}}const x={_o:"allowCrawlerActivity",Ro:"baseUrl",Wo:"noCookies",Aa:"disablePushTokenMaintenance",Yo:"enableLogging",Xo:"enableSdkAuthentication",qa:"manageServiceWorkerExternally",Zo:"minimumIntervalBetweenTriggerActionsInSeconds",Wh:"sessionTimeoutInSeconds",Vh:"appVersion",Kh:"appVersionNumber",Ma:"serviceWorkerLocation",ka:"safariWebsitePushId",re:"allowUserSuppliedJavascript",Lh:"requireExplicitInAppMessageDismissal",Jh:"deviceId",_a:"serviceWorkerScope",Yh:"sdkFlavor"};class ks{constructor(){this.sn="",this.Xh="",this.Zh=void 0,this.Qh=null,this.on=null,this.B=null,this.Cn=null,this.h=null,this.C=null,this.j=null,this.Cs=null,this.Ea="",this.isInitialized=!1,this.Ia=!1,this.Sa=new $,this.Na=new $,this.options={},this.Oa=[],this.Ta=[],this.yi=[],this.Xh="6.2.0"}Ra(t){this.Sa.wt(t)}mh(t){this.Na.wt(t)}initialize(t,e){if(this.ao())return h.info("Braze has already been initialized with an API key."),!0;this.options=e||{};let s=this.ee(x.Yo);const i=Ts(Ss.Ca());if(i&&i.brazeLogging==="true"&&(s=!0),h.init(s),h.info(`Initialization Options: ${JSON.stringify(this.options,null,2)}`),t==null||t===""||typeof t!="string")return h.error("Braze requires a valid API key to be initialized."),!1;this.sn=t;let r=this.ee(x.Ro);if(r==null||r===""||typeof r!="string")return h.error("Braze requires a valid baseUrl to be initialized."),!1;/^https?:/.test(r)===!1&&(r=`https://${r}`);const o=r;if(r=document.createElement("a"),r.href=o,r.pathname==="/"&&(r=`${r}api/v3`),this.Ea=r.toString(),rt.Pa&&!this.ee(x._o))return h.info("Ignoring activity from crawler bot "+navigator.userAgent),this.Ia=!0,!1;const l=this.ee(x.Wo)||!1;if(this.j=Ne.La(t,l),l&&this.j.Da(t),new L.ne(null,!0).br(d.ie))return h.info("Ignoring all activity due to previous opt out"),this.Ia=!0,!1;for(const p of lt(this.options))zt(he).indexOf(p)===-1&&h.warn(`Ignoring unknown initialization option '${p}'.`);const u=["mparticle","wordpress","tealium"];if(this.ee(x.Yh)!=null){const p=this.ee(x.Yh);u.indexOf(p)!==-1?this.Zh=p:h.error("Invalid sdk flavor passed: "+p)}let c=this.ee(he.Vo);if(c!=null)if(F(c)){const p=[];for(let m=0;m<c.length;m++)ut(at,c[m],"devicePropertyAllowlist contained an invalid value.","DeviceProperties")&&p.push(c[m]);c=p}else h.error("devicePropertyAllowlist must be an array. Defaulting to all properties."),c=null;const f=this.ee(x.Jh);if(f){const p=new it(f);this.j.uu(d.iu.Jh,p)}this.on=new ls(this.j,c),this.h=new ds(this.j),this.Cs=new Ns(this.h,this.j),this.C=new fs(this.j,this.Cs,this.h,this.ee(x.Wh));const g=new $;return this.Qh=new os(this.j,this.ee(x.Xo),g),this.q(g),this.B=new hs(this.on,this.j,this.Qh,this.Cs,this.C,this.h,this.sn,this.Ea,this.Xh,this.Zh||"",this.ee(x.Vh),this.ee(x.Kh)),this.Cn=new cs(this.sn,this.Ea,this.C,this.on,this.Cs,this.h,this.j,p=>{if(this.ao())for(const m of this.lr())m.N(p)},this.Qh,this.B),this.Cn.initialize(),l||this.j.Ua(),h.info(`Initialized for the Braze backend at "${this.ee(x.Ro)}" with API key "${this.sn}".`),P.t(),this.h.Ue(()=>{var p;this.isInitialized&&(!((p=this.h)===null||p===void 0)&&p.Re())&&Wt(()=>import("./BIU7wqK-.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url).then(m=>{this.isInitialized&&(0,m.default)()})}),this.Cn.rn(()=>{var p;this.isInitialized&&(!((p=this.h)===null||p===void 0)&&p.Re())&&Wt(()=>import("./BIU7wqK-.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url).then(m=>{this.isInitialized&&(0,m.default)(void 0,void 0,!0)})}),this.Sa.L(this.options),this.isInitialized=!0,window.dispatchEvent(new CustomEvent("braze.initialized")),!0}destroy(t){if(h.destroy(),this.ao()){this.Na.L(),this.Na.removeAllSubscriptions();for(const e of this.Oa)e.destroy();this.Oa=[];for(const e of this.Ta)e.clearData(!1);this.B&&this.B.fo(),this.Ta=[],this.removeAllSubscriptions(),this.yi=[],this.Cn!=null&&this.Cn.destroy(),this.Cn=null,this.Qh=null,this.on=null,this.B=null,this.h=null,this.C=null,this.Cs=null,this.options={},this.Zh=void 0,this.isInitialized=!1,this.Ia=!1,t&&(this.j=null)}}rr(){return!this.Wa()&&(!!this.ao()||(console.warn(te),!1))}ba(){return this.sn}Sr(){return this.Qh}V(){return this.Ea}de(){return this.on}m(){return this.B}ee(t){return this.options[t]}lr(){return this.Ta}nn(){return this.Cn}l(){return this.h}u(){return this.C}p(){return this.j}gr(){if(this.Cs&&this.Cn)return new O(this.Cs,this.Cn)}ir(){return this.Cs}tr(){return this.ee(x.re)===!0}g(t){let e=!1;for(const s of this.Oa)s===t&&(e=!0);e||this.Oa.push(t)}v(t){let e=!1;for(const s of this.Ta)s.constructor===t.constructor&&(e=!0);t instanceof ne&&!e&&this.Ta.push(t)}q(t){t instanceof $&&this.yi.push(t)}removeAllSubscriptions(){if(this.rr())for(const t of this.yi)t.removeAllSubscriptions()}removeSubscription(t){if(this.rr())for(const e of this.yi)e.removeSubscription(t)}ce(t){this.Ia=t}ao(){return this.isInitialized}Wa(){return this.Ia}Vs(){return this.Xh}}const b=new ks,Q={rt:(n,t,e)=>{var s,i;const r=new It,o=b.u();if(!o)return h.info(`Not logging event with type "${n}" because the current session ID could not be found.`),r;const l=o.qo();return r.ue.push(new X(e||((s=b.ir())===null||s===void 0?void 0:s.getUserId()),n,new Date().valueOf(),l,t)),r.W=((i=b.p())===null||i===void 0?void 0:i.Eo(r.ue))||!1,r}};function Is(n,t){if(!b.rr())return;if(n==null||n.length===0||n!=n)return void h.error("changeUser requires a non-empty userId.");if(Bt(n)>O.mr)return void h.error(`Rejected user id "${n}" because it is longer than ${O.mr} bytes.`);if(t!=null&&!H(t,"set signature for new user","signature"))return;const e=b.nn();e&&e.changeUser(n.toString(),b.lr(),t)}function As(){const n=b.nn();n&&n.requestImmediateDataFlush();const t=new L.ne(null,!0),e="This-cookie-will-expire-in-"+t.se();t.store(d.ie,e);const s=A.Us.Rs;new A(s,h).setItem(s.Fs.le,s.me,!0),h.info("disableSDK was called"),b.destroy(!1),b.ce(!0)}function js(){new L.ne(null,!0).remove(d.ie);const n=A.Us.Rs;new A(n,h).be(n.Fs.le,n.me),h.info("enableSDK was called"),b.destroy(!1),b.ce(!1)}function _s(n,t){return b.initialize(n,t)}function Rs(){if(!b.rr())return;const n=b.nn();if(!n)return;n.openSession();const t=A.Us.Rs,e=new A(t,h);e.jr(t.Fs.hr,(s,i)=>{const r=i.lastClick,o=i.trackingString;h.info(`Firing push click trigger from ${o} push click at ${r}`);const l=n.kr(r,o),u=function(){P.o().ve(J.vr,[o],l)};n.$r(u,u),e.be(t.Fs.hr,s)}),e.Ds(t.Fs.wr,function(s){n.yr(s)})}function Bs(n){if(!b.rr()||n===""||!H(n,"set signature","signature",!1))return!1;const t=b.Sr();return!!t&&(t.setSdkAuthenticationSignature(n),!0)}function Ds(n){var t;if(b.rr())return(t=b.Sr())===null||t===void 0?void 0:t.subscribeToSdkAuthenticationFailures(n)}function pe(){const n=b.p();if(n==null)return void h.warn(te);n.clearData();const t=lt(A.Us);for(let s=0;s<t.length;s++){const i=t[s],r=A.Us[i];new A(r,h).clearData()}if(b.rr())for(const s of b.lr())s.clearData(!0);const e=b.m();e&&e.fo()}class xs{constructor(t){this.properties=t,this.properties=t||{}}To(t,e,s){const i=this.properties[t];return i==null?(this.No(t),null):e(i)?i.value:(this.Oo(s),null)}getStringProperty(t){return this.To(t,this.Fo,"string")}getNumberProperty(t){return this.To(t,this.Go,"number")}getBooleanProperty(t){return this.To(t,this.Ho,"boolean")}getImageProperty(t){return this.To(t,this.Ko,"image")}getJsonProperty(t){return this.To(t,this.Lo,"jsonobject")}getTimestampProperty(t){return this.To(t,this.Qo,"datetime")}Oo(t){h.info(`Property is not of type ${t}.`)}No(t){h.info(`${t} not found in properties.`)}Fo(t){return t.type==="string"&&typeof t.value=="string"}Go(t){return t.type==="number"&&typeof t.value=="number"}Ho(t){return t.type==="boolean"&&typeof t.value=="boolean"}Ko(t){return t.type==="image"&&typeof t.value=="string"}Lo(t){return t.type==="jsonobject"&&typeof t.value=="object"&&t.value.constructor==Object}Qo(t){return t.type==="datetime"&&typeof t.value=="number"}}class Ae extends xs{constructor(t,e,s,i=!1,r=!1,o=-1,l={}){super(l),this.id=t,this.placementId=e,this.html=s,this.xt=i,this.isControl=r,this.zt=o,this.id=t,this.placementId=e,this.html=s,this.xt=i,this.isControl=r,this.zt=o,this.kt=!1}At(){return this.isControl}dt(){return{id:this.id,pid:this.placementId,html:this.html,its:this.xt,ic:this.isControl,eat:this.zt,pr:this.properties}}}function Ls(n){return new Ae(n.id,n.pid,n.html,n.its,n.ic,n.eat,n.pr)}function Us(n){return new Ae(n.id,n.placement_id,n.html,n.is_test_send,n.is_control,n.expires_at,n.properties)}class Ps extends ne{constructor(t,e,s,i){super(),this.h=t,this.B=e,this.j=s,this.C=i,this.banners={},this.h=t,this.B=e,this.j=s,this.C=i,this.S=10,this.T=null,this.I=null,this.R=new $,b.q(this.R),this.D=null,this.F=null}N(t){if(this.k()&&t!=null&&t.banners){this.banners={};const e=t.banners;for(const s in e){const i=e[s];let r=null;i!=null&&i.banner!=null&&(r=Us(i.banner)),r&&(this.banners[s]=r)}this.U(),this.R.L(this.banners)}}M(t,e,s,i=!0){var r;const o=()=>{typeof s=="function"&&s()};if(!this.k())return void((r=this.h)===null||r===void 0||r.P(()=>{this.M(t,e,s)}));const l=this.B;if(!l)return void o();i&&this.X();const u=l.$({},!0),c=[];for(const p of t)c.push({id:p});u.placements=c;const f=l.A(u,E.H.G);let g=!1;l.J(u,(p=-1)=>{const m=this.B;if(!m)return void o();const v=new Date().valueOf();E.K(this.j,E.H.G,v),p!==-1&&f.push(["X-Braze-Req-Tokens-Remaining",p.toString()]),re.O({url:`${m.V()}/banners/sync`,headers:f,data:u,W:w=>{if(!m.Y(u,w,f))return g=!0,void o();m.Z(),this.N(w),g=!1,typeof e=="function"&&e()},error:w=>{m._(w,"retrieving banners"),g=!0,o()},tt:(w,y)=>{let T;if(this.F=t,g){let C=this.T;(C==null||C<1e3*this.S)&&(C=1e3*this.S),T=Math.min(3e5,oe(1e3*this.S,3*C))}m.st(y,()=>{this.M(t,e,s,!1)},E.H.G,C=>this.it(C),()=>this.X(),T)}})},E.H.G,s)}et(){return this.F}nt(t,e){const s={id:t.id};return e&&(s.bid=e),Q.rt(I.ot,s).W}X(){this.I!=null&&(clearTimeout(this.I),this.I=null)}it(t){this.X(),this.I=t}ht(){let t={};this.j&&(t=this.j.lt(d.ct.ut));const e={};for(const s in t){let i=null;t[s]!=null&&(i=Ls(t[s])),i&&(e[i.placementId]=i)}return e}U(){var t;if(!this.j)return;const e={};for(const s in this.banners){const i=((t=this.banners[s])===null||t===void 0?void 0:t.dt())||null;e[s]=i}this.j.ft(d.ct.ut,e),this.vt()}vt(){var t,e;(t=this.j)===null||t===void 0||t.ft(d.ct.gt,(e=this.C)===null||e===void 0?void 0:e.bt())}Bt(){var t;return((t=this.j)===null||t===void 0?void 0:t.lt(d.ct.gt))||null}jt(){return this.D}yt(t){this.D=t}Ct(){var t;const e=(t=this.C)===null||t===void 0?void 0:t.bt(),s=this.Bt();return s==null||e===s}St(t){return this.R.wt(t)}Tt(){var t;return((t=this.j)===null||t===void 0?void 0:t.lt(d.ct.It))||{}}Rt(t){this.j&&this.j.ft(d.ct.It,t)}changeUser(){this.qt(),this.X()}clearData(){this.X()}k(){return!!this.h&&(!!this.h.Dt()||(this.h.Ft()!==0&&this.qt(),!1))}qt(){this.banners={},this.j&&(this.j.Nt(d.ct.ut),this.j.Nt(d.ct.It)),this.R.L({})}}const W={i:!1,provider:null,o:()=>(W.t(),W.provider||(W.provider=new Ps(b.l(),b.m(),b.p(),b.u()),b.v(W.provider)),W.provider),t:()=>{W.i||(b.g(W),W.i=!0)},destroy:()=>{W.provider=null,W.i=!1}};function $s(n,t){const e=n[t];if(!e)return null;const s=e.zt,i=new Date().valueOf();return s!==-1&&1e3*s<i?(h.info(`Banner with ID: ${e.id} and placement ID: ${t} has expired.`),null):e}function Fs(){if(!b.rr())return;const n={},t=b.l();if(t?.Dt()===!1&&h.error(ye),!t?.Dt())return n;const e=W.o().ht();for(const s in e)n[s]=$s(e,s);return n}function zs(n){var t;if(!b.rr())return;const e=W.o();if(e.Ct()){const i=Fs();i&&typeof n=="function"&&n(i)}const s=e.St(n);if(!e.jt()){const i=(t=b.nn())===null||t===void 0?void 0:t.rn(()=>{const r=e.et();r&&r.length>0&&e.M(r)});i&&e.yt(i)}return s}function je(n,t,e){if(!b.rr())return void h.warn(te);const s=b.l();if(!s)return;if(!F(n)||n.length===0)return void h.warn("placementIds should be a non-empty array.");if(!b.ee(x.re))return void h.error("Banners are disabled. Use the 'allowUserSuppliedJavascript' option for braze.initialize to enable these messages.");const i=W.o();if(s.Dt()===!1&&h.error(ye),!i.k())return void s.P(()=>{je(n,t,e)});const r=s.te();n.length>r&&(h.warn(`Number of placement IDs requested exceeds the max allowed. Trimming placementIds array from length ${n.length} to ${r} (max allowed).`),n=n.slice(0,r)),(n=n.filter(o=>!!rs(o)||(h.warn(`Placement ID should be a valid utf8 string with no whitespaces, filtering out: ${o}`),!1))).length!==0&&(h.info(`Requesting banners for placement IDs: ${JSON.stringify(n)}`),i.M(n,t,e))}const qs=new Ue("/api/engagement/braze-authentication.json",Pe.POST),_e=c24.getData("brazeApiKey");if(_e==null)throw new Error("Braze is not active!");const Js=c24.getData("brazeSdkEndpoint"),me=c24.getData("brazeUserId"),Gs=c24.getData("brazeUserSignature"),Re=c24.getData("brazeHasConsent");Re?js():(As(),ue());_s(_e,{baseUrl:Js,enableSdkAuthentication:!0,allowUserSuppliedJavascript:!0,enableLogging:!1,noCookies:!0});const Vs=new $e(qs);let _t=!1;async function Ks(){if(_t!==!0){ue();try{const{data:n}=await Vs.post(),t=n.brazeSession?.authenticationToken;t!=null?(Bs(t),_t=!1):_t=!0}catch{_t=!0}}}function Be(){const n=localStorage?.getItem("braze.bannerLastUpdated");if(n==null)return{};try{return JSON.parse(n)}catch{return{}}}function ue(){localStorage?.removeItem("braze.bannerLastUpdated")}function Hs(n){const t=Date.now(),e={};for(const i of n)e[i]=t;const s={...Be(),...e};localStorage?.setItem("braze.bannerLastUpdated",JSON.stringify(s))}function Ws(n){const s=Date.now()-72e5,i=Be();return n.filter(r=>i[r]==null||i[r]<s)}const De=xe({}),be=Le(De);zs(n=>{De.value=n});const Qs=Array.from(document.querySelectorAll("[data-braze-banner-id]")).map(n=>n.getAttribute("data-braze-banner-id")).filter(n=>n!=null),Ht=Ws(Qs);Ht.length>0&&je(Ht,()=>{Hs(Ht)});Ds(Ks);Re?(me!=null?Is(me,Gs):ge()?.getUserId()!=null&&(pe(),ue()),Rs(),ge()?.setLanguage(c24.meta.language)):pe();function Zs(n){const t=Vt(()=>be.value[n]==null),e=Vt(()=>t.value===!1),s=Vt(()=>be.value[n]??void 0);return{loading:t,loaded:e,banner:s}}export{h as E,xs as P,d as S,O as U,$ as a,re as b,oe as c,St as d,le as e,ot as g,E as h,F as i,b as r,ne as t,Zs as u,q as y,x as z};

import{a as q,y as d,p as x,r as P,aq as z,b as o,e as _,o as l,F as M,B as L,q as i,v as m,E as y,G as N,t as h,aw as g,a6 as S,_ as j,n as R,aj as W,w as U,T as D,ai as F,a5 as G}from"./QjRxgrZG.js";import{g as H,t as K,R as Y,v as Q,l as V,H as X,ar as J,aq as $}from"./BXE2Xjof.js";import{U as ee,V as O,R as Z}from"./DOsRtn-5.js";import{C as se}from"./Bl98DKm_.js";const B=[{queryLabel:"Rolex Daytona",url:"/rolex/daytona--mod2.htm"},{queryLabel:"Rolex Datejust",url:"/rolex/datejust--mod45.htm"},{queryLabel:"Rolex Oyster Perpetual",url:"/rolex/oyster-perpetual--mod55.htm"},{queryLabel:"Audemars Piguet Royal Oak",url:"/audemarspiguet/royal-oak--mod116.htm"},{queryLabel:"Patek Phillipe Nautilus",url:"/patekphilippe/nautilus--mod106.htm"}];var b,E;function re(){if(E)return b;E=1;var e=ee(),s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},t=e(s);return b=t,b}var v,I;function te(){if(I)return v;I=1;var e=re(),s=O(),t=/[&<>"']/g,u=RegExp(t.source);function a(r){return r=s(r),r&&u.test(r)?r.replace(t,e):r}return v=a,v}var ae=te();const C=H(ae);var k,w;function ne(){if(w)return k;w=1;var e=O(),s=/[\\^$.*+?()[\]{}|]/g,t=RegExp(s.source);function u(a){return a=e(a),a&&t.test(a)?a.replace(s,"\\$&"):a}return k=u,k}var oe=ne();const le=H(oe),T=(e,s)=>{if(s==="")return e;const t=new RegExp(le(s),"gi");let u=0,a="",r;for(;(r=t.exec(e))!==null;)a+=C(e.slice(u,r.index)),a+=`<mark role="presentation">${C(r[0])}</mark>`,u=t.lastIndex;return a+=C(e.slice(u)),a},ie={beforeMount(e,s){const{keyword:t}=s.value;t&&(e.innerHTML=T(e.innerText,t))},updated(e,s){const{keyword:t}=s.value;t&&(e.innerHTML=T(e.innerText,t))},unmounted(e){e.innerText=e.innerText}},ce={components:{C24Icon:se},directives:{"highlight-text":ie},mixins:[Z],props:{suggestions:{type:Array,required:!0},query:{type:String,required:!1,default:""},isRecentSearchesSuggestions:{type:Boolean,required:!1,default:!1}},computed:{Icon(){return x}},methods:{trackInteractionEvent:K,localizeKey:d,focusSuggestion(e){this.$refs[`main-search-suggestion-${e}`]&&(Array.isArray(this.$refs[`main-search-suggestion-${e}`])?this.$refs[`main-search-suggestion-${e}`][0].focus():this.$refs[`main-search-suggestion-${e}`].focus())}}},ue={key:0,class:"suggestion-list list-unstyled m-b-0"},he=["href","onClick","onKeydown"],_e={key:0},pe={class:"d-block text-sm text-muted text-line-clamp-3"},de={key:0},ge={key:1},Se={key:2},me={key:0,class:"m-y-0"},ye={key:0};function Ae(e,s,t,u,a,r){const A=P("C24Icon"),f=z("highlight-text");return t.suggestions?(l(),o("ul",ue,[(l(!0),o(M,null,L(t.suggestions,(c,n)=>(l(),o("li",{key:c.queryLabel+c.conditionLabel+c.explanation},[i("a",{ref_for:!0,ref:`main-search-suggestion-${n}`,href:c.url,class:"d-flex p-a-3 text-lg text-decoration-none",tabindex:"-1",onClick:p=>{r.trackInteractionEvent("search",c.queryLabel,"suggestion",{search_term:c.queryLabel})},onKeydown:[g(S(p=>r.focusSuggestion(n-1),["prevent"]),["up"]),g(S(p=>r.focusSuggestion(n+1),["prevent"]),["down"])]},[e.isMobile?_("",!0):(l(),o("span",_e,[m(A,{icon:t.isRecentSearchesSuggestions?r.Icon.Recent:r.Icon.Search,class:"d-block m-t-1 m-r-2"},null,8,["icon"])])),i("span",null,[y((l(),o("span",null,[N(h(c.queryLabel),1)])),[[f,{keyword:t.query}]]),i("span",pe,[c.conditionLabel?(l(),o("span",de,h(c.conditionLabel),1)):c.explanation?(l(),o("span",ge,h(c.explanation),1)):(l(),o("span",Se,h(r.localizeKey({"en":"All listings"})),1))])])],40,he),e.isMobile?(l(),o("hr",me)):_("",!0)]))),128)),t.query?(l(),o("li",ye,[i("button",{ref:`main-search-suggestion-${t.suggestions.length}`,class:"d-block w-100 link p-a-3 text-lg",tabindex:"-1",type:"submit",onKeydown:s[0]||(s[0]=g(S(c=>r.focusSuggestion(t.suggestions.length-1),["prevent"]),["up"]))},h(r.localizeKey({"en":"Show all listings for \"{0}\""},t.query)),545)])):_("",!0)])):_("",!0)}const fe=q(ce,[["render",Ae],["__scopeId","data-v-08c65c13"]]),be=new Y,ve={name:"MainSearch",components:{C24Icon:j,SuggestionList:fe},directives:{"click-outside":Q},mixins:[Z],props:{jsId:{required:!0,type:String},label:{required:!0,type:String},placeholder:{required:!0,type:String}},setup(){return{debouncedSearchInput:$(async s=>{await s.fetch()},400,{maxWait:2e3})}},data(){return{query:new URLSearchParams(window.location.search).get("query")??"",params:{},listingType:"watches",listingTypes:{watches:d({"en":"Watches"}),accessories:d({"en":"Parts/Accessories"}),straps:d({"en":"Bracelets/Straps"})},cachedSuggestions:{popularSearches:B,recentSearches:localStorage.getItem("recentSearches")?JSON.parse(localStorage.getItem("recentSearches")):[],watches:{},accessories:{},straps:{}},currentSuggestions:[],isLoading:!1,isOpen:!1}},computed:{Icon(){return x},querySuggestApiUrl(){return J("/api/search/querysuggest.json",{query:this.trimmedQuery,...this.params})},trimmedQuery(){return this.query.trim()}},watch:{isOpen(e){this.isMobile&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{X(!e)})})},listingType(e){this.params={},e==="watches"?this.params.type="Watch":e==="accessories"?this.params.type="Accessory":e==="straps"&&(this.params.type="Accessory",this.params.accessoryType="BandStrap"),this.fetch()}},mounted(){this.getSuggestions()},methods:{trackInteractionEvent:K,localizeKey:d,getSuggestions(){this.currentSuggestions=localStorage.getItem("recentSearches")?JSON.parse(localStorage.getItem("recentSearches")):B},onSearchInput(){this.isLoading=!0,this.debouncedSearchInput(this)},onFocusout(e){e.relatedTarget&&!this.$el.contains(e.relatedTarget)&&this.closeSuggestions()},cancelSearch(){this.query="",this.listingType="watches",this.closeSuggestions()},closeSuggestions(){this.isOpen=!1},openSuggestions(){this.getSuggestions(),this.cachedSuggestions.recentSearches=localStorage.getItem("recentSearches")?JSON.parse(localStorage.getItem("recentSearches")):[],this.isOpen=!0,document.documentElement.style.setProperty("--visible-header-height",`${document.querySelector(".js-header").getBoundingClientRect().bottom}px`)},focusFirstSuggestion(){this.$refs.suggestionList.focusSuggestion(0)},async fetch(){if(this.trimmedQuery===""){this.isLoading=!1,this.getSuggestions();return}this.isLoading=!0;try{const e=this.listingType,s=this.trimmedQuery,{data:t}=await be.get(this.querySuggestApiUrl);this.currentSuggestions=Array.from(t.searchQuerySuggestions),this.cachedSuggestions[e][s]=Array.from(t.searchQuerySuggestions),this.isLoading=!1}catch(e){(e.name==="TimeoutError"||e.name==="TypeError")&&(V("Error fetching query suggestion","main-search.vue",e),this.isLoading=!1)}}}},Ce={class:"form-group m-b-0"},ke={class:"flex-grow-1"},Pe={class:"visually-hidden",for:"query"},Re={class:"relative"},Be={class:"input-addition bg-surface-container-neutral prepend"},Ee=["aria-controls","placeholder"],Ie=["id"],we={key:0,class:"listing-type-button-wrapper bg-surface-container-default border-bottom m-b-2"},Te={class:"d-flex p-t-2 p-x-2"},qe=["onClick"],xe={class:"relative p-x-2 p-b-2"},ze={key:0,class:"loading-overlay"},Me={key:0,class:"text-bold p-x-3 p-t-2 p-b-1"};function Le(e,s,t,u,a,r){const A=P("C24Icon"),f=P("SuggestionList"),c=z("click-outside");return y((l(),o("form",{action:"/search/index.htm",class:"form-lg",onFocusout:s[7]||(s[7]=(...n)=>r.onFocusout&&r.onFocusout(...n)),onSubmit:s[8]||(s[8]=n=>{r.trackInteractionEvent("search",r.trimmedQuery,"input",{search_term:r.trimmedQuery})}),onKeydown:s[9]||(s[9]=g(S((...n)=>r.closeSuggestions&&r.closeSuggestions(...n),["prevent"]),["esc"]))},[s[11]||(s[11]=i("input",{value:!0,name:"dosearch",type:"hidden"},null,-1)),i("div",Ce,[i("div",{class:R({"input-group":a.isOpen})},[i("div",ke,[i("label",Pe,h(t.label),1),i("div",Re,[i("div",Be,[m(A,{icon:r.Icon.Search},null,8,["icon"])]),y(i("input",{ref:"main-search-input","onUpdate:modelValue":s[0]||(s[0]=n=>a.query=n),"aria-controls":t.jsId+"-suggestions",placeholder:t.placeholder,"aria-autocomplete":"list","aria-expanded":"false",autocomplete:"off",class:"wt-main-search-input main-search-input form-control",maxlength:"255",name:"query",role:"combobox",type:"search",onClick:s[1]||(s[1]=(...n)=>r.openSuggestions&&r.openSuggestions(...n)),onFocus:s[2]||(s[2]=(...n)=>r.openSuggestions&&r.openSuggestions(...n)),onInput:s[3]||(s[3]=(...n)=>r.onSearchInput&&r.onSearchInput(...n)),onKeydown:s[4]||(s[4]=g(S(n=>a.isOpen?r.focusFirstSuggestion():r.openSuggestions(),["prevent"]),["down"]))},null,40,Ee),[[W,a.query]])])]),a.isOpen?(l(),o("button",{key:0,class:"main-search-cancel-button link text-sm bg-surface-container-neutral p-x-2",type:"button",onClick:s[5]||(s[5]=(...n)=>r.cancelSearch&&r.cancelSearch(...n))},h(r.localizeKey({"en":"Cancel"})),1)):_("",!0)],2),y(i("div",{id:t.jsId+"-suggestions",class:"main-search-dropdown elevated",onScroll:s[6]||(s[6]=(...n)=>e.onScroll&&e.onScroll(...n))},[r.trimmedQuery?(l(),o("div",we,[i("div",Te,[(l(!0),o(M,null,L(a.listingTypes,(n,p)=>(l(),o("button",{key:p,class:R([{active:a.listingType===p},"listing-type-button flex-grow-1 link p-a-2 text-lg text-decoration-none text-center"]),type:"button",onClick:Oe=>a.listingType=p},h(n),11,qe))),128))])])):_("",!0),i("div",xe,[m(D,{name:"fade-normal"},{default:U(()=>[a.isLoading?(l(),o("div",ze,s[10]||(s[10]=[i("div",{class:"spinner-sm"},null,-1)]))):_("",!0)]),_:1}),r.trimmedQuery?_("",!0):(l(),o("div",Me,h(a.cachedSuggestions.recentSearches.length>0?r.localizeKey({"en":"Recent searches"}):r.localizeKey({"en":"Popular Searches"})),1)),m(f,{ref:"suggestionList","is-recent-searches-suggestions":!r.trimmedQuery&&a.cachedSuggestions.recentSearches.length>0,query:r.trimmedQuery,suggestions:a.currentSuggestions},null,8,["is-recent-searches-suggestions","query","suggestions"])])],40,Ie),[[F,a.isOpen]])])],32)),[[c,r.closeSuggestions,a.isOpen]])}const He=q(ve,[["render",Le],["__scopeId","data-v-9a46b3ed"]]);function Ke(e){G(He,{jsId:e,label:document.querySelector(`#${e} .js-main-search-label`).innerText,placeholder:document.querySelector(`#${e} .js-main-search-input`).placeholder}).mount(`#${e}`)}window.initMainSearch=Ke;
